import{ChaCha20Poly1305 as Y}from"@stablelib/chacha20poly1305";import{HKDF as Be}from"@stablelib/hkdf";import{randomBytes as W}from"@stablelib/random";import{SHA256 as Ge,hash as J}from"@stablelib/sha256";import*as Q from"@stablelib/x25519";import{toString as d,fromString as l,concat as Z}from"uint8arrays";import{detect as ze}from"detect-browser";import{fromMiliseconds as X,toMiliseconds as D,FIVE_MINUTES as Ye}from"@walletconnect/time";import{getDocument as We,getNavigator as ee,getLocation as ne}from"@walletconnect/window-getters";import{getWindowMetadata as Je}from"@walletconnect/window-metadata";import*as T from"query-string";import{RELAY_JSONRPC as Qe}from"@walletconnect/relay-api";const P=":";function te(e){const[n,t]=e.split(P);return{namespace:n,reference:t}}function re(e){const{namespace:n,reference:t}=e;return[n,t].join(P)}function $(e){const[n,t,r]=e.split(P);return{namespace:n,reference:t,address:r}}function oe(e){const{namespace:n,reference:t,address:r}=e;return[n,t,r].join(P)}function j(e,n){const t=[];return e.forEach(r=>{const o=n(r);t.includes(o)||t.push(o)}),t}function se(e){const{address:n}=$(e);return n}function ie(e){const{namespace:n,reference:t}=$(e);return re({namespace:n,reference:t})}function Ze(e,n){const{namespace:t,reference:r}=te(n);return oe({namespace:t,reference:r,address:e})}function Xe(e){return j(e,se)}function ce(e){return j(e,ie)}function en(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...o.accounts)}),t}function nn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...ce(o.accounts))}),t}function tn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...o.chains)}),t}const U=e=>e?.split(":"),ae=e=>{const n=e&&U(e);if(n)return n[3]},rn=e=>{const n=e&&U(e);if(n)return n[2]+":"+n[3]},ue=e=>{const n=e&&U(e);if(n)return n.pop()},on=(e,n)=>{const t=`${e.domain} wants you to sign in with your Ethereum account:`,r=ue(n),o=e.statement,s=`URI: ${e.aud}`,i=`Version: ${e.version}`,u=`Chain ID: ${ae(n)}`,f=`Nonce: ${e.nonce}`,g=`Issued At: ${e.iat}`,O=e.resources&&e.resources.length>0?`Resources:
${e.resources.map(p=>`- ${p}`).join(`
`)}`:void 0;return[t,r,"",o,"",s,i,u,f,g,O].filter(p=>p!=null).join(`
`)},V="base10",c="base16",R="base64pad",_="utf8",M=0,N=1,sn=0,de=1,K=12,k=32;function cn(){const e=Q.generateKeyPair();return{privateKey:d(e.secretKey,c),publicKey:d(e.publicKey,c)}}function an(){const e=W(k);return d(e,c)}function un(e,n){const t=Q.sharedKey(l(e,c),l(n,c)),r=new Be(Ge,t).expand(k);return d(r,c)}function dn(e){const n=J(l(e,c));return d(n,c)}function ln(e){const n=J(l(e,_));return d(n,c)}function le(e){return l(`${e}`,V)}function S(e){return Number(d(e,V))}function fn(e){const n=le(typeof e.type<"u"?e.type:M);if(S(n)===N&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof e.senderPublicKey<"u"?l(e.senderPublicKey,c):void 0,r=typeof e.iv<"u"?l(e.iv,c):W(K),o=new Y(l(e.symKey,c)).seal(r,l(e.message,_));return fe({type:n,sealed:o,iv:r,senderPublicKey:t})}function pn(e){const n=new Y(l(e.symKey,c)),{sealed:t,iv:r}=L(e.encoded),o=n.open(r,t);if(o===null)throw new Error("Failed to decrypt");return d(o,_)}function fe(e){if(S(e.type)===N){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return d(Z([e.type,e.senderPublicKey,e.iv,e.sealed]),R)}return d(Z([e.type,e.iv,e.sealed]),R)}function L(e){const n=l(e,R),t=n.slice(sn,de),r=de;if(S(t)===N){const u=r+k,f=u+K,g=n.slice(r,u),O=n.slice(u,f),p=n.slice(f);return{type:t,sealed:p,iv:O,senderPublicKey:g}}const o=r+K,s=n.slice(r,o),i=n.slice(o);return{type:t,sealed:i,iv:s}}function mn(e,n){const t=L(e);return pe({type:S(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?d(t.senderPublicKey,c):void 0,receiverPublicKey:n?.receiverPublicKey})}function pe(e){const n=e?.type||M;if(n===N){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:n,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function yn(e){return e.type===N&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}var En=Object.defineProperty,me=Object.getOwnPropertySymbols,gn=Object.prototype.hasOwnProperty,hn=Object.prototype.propertyIsEnumerable,ye=(e,n,t)=>n in e?En(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Ee=(e,n)=>{for(var t in n||(n={}))gn.call(n,t)&&ye(e,t,n[t]);if(me)for(var t of me(n))hn.call(n,t)&&ye(e,t,n[t]);return e};const ge="ReactNative",v={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},A=" ",Nn=":",he="/",x=2,vn=1e3,Ne="js";function F(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ve(){return!We()&&!!ee()&&navigator.product===ge}function be(){return!F()&&!!ee()}function H(){return ve()?v.reactNative:F()?v.node:be()?v.browser:v.unknown}function Oe(e,n){let t=T.parse(e);return t=Ee(Ee({},t),n),e=T.stringify(t),e}function bn(){return Je()||{name:"",description:"",url:"",icons:[""]}}function On(e,n){var t;const r=H(),o={protocol:e,version:n,env:r};return r==="browser"&&(o.host=((t=ne())==null?void 0:t.host)||"unknown"),o}function Se(){const e=ze();if(e===null)return"unknown";const n=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[n,e.name,e.version].join("-"):[n,e.version].join("-")}function Ie(){var e;const n=H();return n===v.browser?[n,((e=ne())==null?void 0:e.host)||"unknown"].join(":"):n}function Te(e,n,t){const r=Se(),o=Ie();return[[e,n].join("-"),[Ne,t].join("-"),r,o].join("/")}function Sn({protocol:e,version:n,relayUrl:t,sdkVersion:r,auth:o,projectId:s}){const i=t.split("?"),u=Te(e,n,r),f={auth:o,ua:u,projectId:s},g=Oe(i[1]||"",f);return i[0]+"?"+g}function In(e){let n=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const t=typeof n<"u"?e.split("://")[1]:e;return n=n==="wss"?"https":"http",[n,t].join("://")}function Tn(e,n,t){if(!e[n]||typeof e[n]!==t)throw new Error(`Missing or invalid "${n}" param`)}function Pe(e,n=x){return Ue(e.split(he),n)}function Pn(e){return Pe(e).join(A)}function m(e,n){return e.filter(t=>n.includes(t)).length===e.length}function Ue(e,n=x){return e.slice(Math.max(e.length-n,0))}function Un(e){return Object.fromEntries(e.entries())}function Rn(e){return new Map(Object.entries(e))}function _n(e,n){const t={};return Object.keys(e).forEach(r=>{t[r]=n(e[r])}),t}const An=e=>e;function Re(e){return e.trim().replace(/^\w/,n=>n.toUpperCase())}function wn(e){return e.split(A).map(n=>Re(n)).join(A)}function Cn(e,n){return X((n||Date.now())+D(e))}function Dn(e){return X(Date.now())>=D(e)}function $n(e){const n=D(e||Ye);let t,r,o;return{resolve:s=>{o&&t&&(clearTimeout(o),t(s))},reject:s=>{o&&r&&(clearTimeout(o),r(s))},done:()=>new Promise((s,i)=>{o=setTimeout(i,n),t=s,r=i})}}function jn(e,n){return new Promise(async(t,r)=>{const o=setTimeout(()=>r(),n),s=await e;clearTimeout(o),t(s)})}function q(e,n){if(typeof n=="string"&&n.startsWith(`${e}:`))return n;if(e.toLowerCase()==="topic"){if(typeof n!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${n}`}else if(e.toLowerCase()==="id"){if(typeof n!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${n}`}throw new Error(`Unknown expirer target type: ${e}`)}function Vn(e){return q("topic",e)}function Mn(e){return q("id",e)}function Kn(e){const[n,t]=e.split(":"),r={id:void 0,topic:void 0};if(n==="topic"&&typeof t=="string")r.topic=t;else if(n==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${n}:${t}`);return r}function kn(e,n){return`${e}${n?`:${n}`:""}`}const _e="irn";function Ln(e){return e?.relay||{protocol:_e}}function xn(e){const n=Qe[e];if(typeof n>"u")throw new Error(`Relay Protocol not supported: ${e}`);return n}var Fn=Object.defineProperty,Ae=Object.getOwnPropertySymbols,Hn=Object.prototype.hasOwnProperty,qn=Object.prototype.propertyIsEnumerable,we=(e,n,t)=>n in e?Fn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Bn=(e,n)=>{for(var t in n||(n={}))Hn.call(n,t)&&we(e,t,n[t]);if(Ae)for(var t of Ae(n))qn.call(n,t)&&we(e,t,n[t]);return e};function Ce(e,n="-"){const t={},r="relay"+n;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=e[o];t[s]=i}}),t}function Gn(e){const n=e.indexOf(":"),t=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,n),o=e.substring(n+1,t).split("@"),s=typeof t<"u"?e.substring(t):"",i=T.parse(s);return{protocol:r,topic:o[0],version:parseInt(o[1],10),symKey:i.symKey,relay:Ce(i)}}function De(e,n="-"){const t="relay",r={};return Object.keys(e).forEach(o=>{const s=t+n+o;e[o]&&(r[s]=e[o])}),r}function zn(e){return`${e.protocol}:${e.topic}@${e.version}?`+T.stringify(Bn({symKey:e.symKey},De(e.relay)))}function b(e){const n=[];return e.forEach(t=>{const[r,o]=t.split(":");n.push(`${r}:${o}`)}),n}function $e(e){const n=[];return Object.values(e).forEach(t=>{n.push(...b(t.accounts))}),n}function je(e,n){const t=[];return Object.values(e).forEach(r=>{b(r.accounts).includes(n)&&t.push(...r.methods)}),t}function Ve(e,n){const t=[];return Object.values(e).forEach(r=>{b(r.accounts).includes(n)&&t.push(...r.events)}),t}function Yn(e,n){const t=He(e,n);if(t)throw new Error(t.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)};return r}const Wn={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Jn={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function y(e,n){const{message:t,code:r}=Jn[e];return{message:n?`${t} ${n}`:t,code:r}}function h(e,n){const{message:t,code:r}=Wn[e];return{message:n?`${t} ${n}`:t,code:r}}function I(e,n){return Array.isArray(e)?typeof n<"u"&&e.length?e.every(n):!0:!1}function B(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function E(e){return typeof e>"u"}function a(e,n){return n&&E(e)?!0:typeof e=="string"&&Boolean(e.trim().length)}function w(e,n){return n&&E(e)?!0:typeof e=="number"&&!isNaN(e)}function Qn(e,n){const{requiredNamespaces:t}=n,r=Object.keys(e.namespaces),o=Object.keys(t);let s=!0;return m(o,r)?(r.forEach(i=>{const{accounts:u,methods:f,events:g}=e.namespaces[i],O=b(u),p=t[i];(!m(p.chains,O)||!m(p.methods,f)||!m(p.events,g))&&(s=!1)}),s):!1}function C(e){return a(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function Me(e){if(a(e,!1)&&e.includes(":")){const n=e.split(":");if(n.length===3){const t=n[0]+":"+n[1];return!!n[2]&&C(t)}}return!1}function Zn(e){if(a(e,!1))try{return typeof new URL(e)<"u"}catch{return!1}return!1}function Xn(e){var n;return(n=e?.proposer)==null?void 0:n.publicKey}function et(e){return e?.topic}function nt(e,n){let t=null;return a(e?.publicKey,!1)||(t=y("MISSING_OR_INVALID",`${n} controller public key should be a string`)),t}function G(e){let n=!0;return I(e)?e.length&&(n=e.every(t=>a(t,!1))):n=!1,n}function Ke(e,n,t){let r=null;return I(n)?n.forEach(o=>{r||(!C(o)||!o.includes(e))&&(r=h("UNSUPPORTED_CHAINS",`${t}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):r=h("UNSUPPORTED_CHAINS",`${t}, chains ${n} should be an array of strings conforming to "namespace:chainId" format`),r}function ke(e,n){let t=null;return Object.entries(e).forEach(([r,o])=>{if(t)return;const s=Ke(r,o?.chains,`${n} requiredNamespace`);s&&(t=s)}),t}function Le(e,n){let t=null;return I(e)?e.forEach(r=>{t||Me(r)||(t=h("UNSUPPORTED_ACCOUNTS",`${n}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=h("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function xe(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=Le(r?.accounts,`${n} namespace`);o&&(t=o)}),t}function Fe(e,n){let t=null;return G(e?.methods)?G(e?.events)||(t=h("UNSUPPORTED_EVENTS",`${n}, events should be an array of strings or empty array for no events`)):t=h("UNSUPPORTED_METHODS",`${n}, methods should be an array of strings or empty array for no methods`),t}function z(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=Fe(r,`${n}, namespace`);o&&(t=o)}),t}function tt(e,n){let t=null;if(e&&B(e)){const r=z(e,n);r&&(t=r);const o=ke(e,n);o&&(t=o)}else t=y("MISSING_OR_INVALID",`${n}, requiredNamespaces should be an object with data`);return t}function He(e,n){let t=null;if(e&&B(e)){const r=z(e,n);r&&(t=r);const o=xe(e,n);o&&(t=o)}else t=y("MISSING_OR_INVALID",`${n}, namespaces should be an object with data`);return t}function qe(e){return a(e.protocol,!0)}function rt(e,n){let t=!1;return n&&!e?t=!0:e&&I(e)&&e.length&&e.forEach(r=>{t=qe(r)}),t}function ot(e){return typeof e=="number"}function st(e){return typeof e<"u"&&typeof e!==null}function it(e){return!(!e||typeof e!="object"||!e.code||!w(e.code,!1)||!e.message||!a(e.message,!1))}function ct(e){return!(E(e)||!a(e.method,!1))}function at(e){return!(E(e)||E(e.result)&&E(e.error)||!w(e.id,!1)||!a(e.jsonrpc,!1))}function ut(e){return!(E(e)||!a(e.name,!1))}function dt(e,n){return!(!C(n)||!$e(e).includes(n))}function lt(e,n,t){return a(t,!1)?je(e,n).includes(t):!1}function ft(e,n,t){return a(t,!1)?Ve(e,n).includes(t):!1}function pt(e,n,t){let r=null;const o=Object.keys(e),s=Object.keys(n);return m(o,s)?o.forEach(i=>{if(r)return;const u=e[i].chains,f=b(n[i].accounts);m(u,f)?m(e[i].methods,n[i].methods)?m(e[i].events,n[i].events)||(r=y("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${i}`)):r=y("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${i}`):r=y("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${i}`)}):r=y("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),r}function mt(e,n){return w(e,!1)&&e<=n.max&&e>=n.min}export{V as BASE10,c as BASE16,R as BASE64,Nn as COLON,x as DEFAULT_DEPTH,A as EMPTY_SPACE,v as ENV_MAP,vn as ONE_THOUSAND,ge as REACT_NATIVE_PRODUCT,_e as RELAYER_DEFAULT_PROTOCOL,Ne as SDK_TYPE,he as SLASH,M as TYPE_0,N as TYPE_1,_ as UTF8,Oe as appendToQueryString,Tn as assertType,Cn as calcExpiry,wn as capitalize,Re as capitalizeWord,$n as createDelayedPromise,jn as createExpiringPromise,S as decodeTypeByte,pn as decrypt,un as deriveSymKey,L as deserialize,le as encodeTypeByte,fn as encrypt,kn as engineEvent,An as enumify,oe as formatAccountId,Ze as formatAccountWithChain,re as formatChainId,q as formatExpirerTarget,Mn as formatIdTarget,on as formatMessage,Pn as formatMessageContext,De as formatRelayParams,Sn as formatRelayRpcUrl,Vn as formatTopicTarget,Te as formatUA,zn as formatUri,cn as generateKeyPair,an as generateRandomBytes32,b as getAccountsChains,en as getAccountsFromNamespaces,se as getAddressFromAccount,Xe as getAddressesFromAccounts,bn as getAppMetadata,ie as getChainFromAccount,ce as getChainsFromAccounts,nn as getChainsFromNamespaces,tn as getChainsFromRequiredNamespaces,ue as getDidAddress,U as getDidAddressSegments,ae as getDidChainId,H as getEnvironment,In as getHttpUrl,y as getInternalError,Ie as getJavascriptID,Se as getJavascriptOS,Ue as getLastItems,rn as getNamespacedDidChainId,$e as getNamespacesChains,Ve as getNamespacesEventsForChainId,je as getNamespacesMethodsForChainId,On as getRelayClientMetadata,xn as getRelayProtocolApi,Ln as getRelayProtocolName,Yn as getRequiredNamespacesFromNamespaces,h as getSdkError,j as getUniqueValues,m as hasOverlap,dn as hashKey,ln as hashMessage,be as isBrowser,pt as isConformingNamespaces,Dn as isExpired,F as isNode,Xn as isProposalStruct,ve as isReactNative,Qn as isSessionCompatible,et as isSessionStruct,yn as isTypeOneEnvelope,E as isUndefined,Me as isValidAccountId,Le as isValidAccounts,Fe as isValidActions,I as isValidArray,C as isValidChainId,Ke as isValidChains,nt as isValidController,it as isValidErrorReason,ut as isValidEvent,ot as isValidId,xe as isValidNamespaceAccounts,z as isValidNamespaceActions,ke as isValidNamespaceChains,G as isValidNamespaceMethodsOrEvents,He as isValidNamespaces,dt as isValidNamespacesChainId,ft as isValidNamespacesEvent,lt as isValidNamespacesRequest,w as isValidNumber,B as isValidObject,st as isValidParams,qe as isValidRelay,rt as isValidRelays,ct as isValidRequest,mt as isValidRequestExpiry,tt as isValidRequiredNamespaces,at as isValidResponse,a as isValidString,Zn as isValidUrl,_n as mapEntries,Un as mapToObj,Rn as objToMap,$ as parseAccountId,te as parseChainId,Pe as parseContextNames,Kn as parseExpirerTarget,Ce as parseRelayParams,Gn as parseUri,fe as serialize,mn as validateDecoding,pe as validateEncoding};
//# sourceMappingURL=index.es.js.map
