(function(qt,qe){typeof exports=="object"&&typeof module<"u"?qe(exports):typeof define=="function"&&define.amd?define(["exports"],qe):(qt=typeof globalThis<"u"?globalThis:qt||self,qe(qt["@walletconnect/universal-provider"]={}))})(this,function(qt){"use strict";var qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Kt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}function uc(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var hc=fc;function fc(t,e,r){var i=r&&r.stringify||uc,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var c=1;c<s;c++)o[c]=i(e[c]);return o.join(" ")}if(typeof t!="string")return t;var f=e.length;if(f===0)return t;for(var h="",l=1-n,D=-1,w=t&&t.length||0,m=0;m<w;){if(t.charCodeAt(m)===37&&m+1<w){switch(D=D>-1?D:0,t.charCodeAt(m+1)){case 100:case 102:if(l>=f||e[l]==null)break;D<m&&(h+=t.slice(D,m)),h+=Number(e[l]),D=m+2,m++;break;case 105:if(l>=f||e[l]==null)break;D<m&&(h+=t.slice(D,m)),h+=Math.floor(Number(e[l])),D=m+2,m++;break;case 79:case 111:case 106:if(l>=f||e[l]===void 0)break;D<m&&(h+=t.slice(D,m));var E=typeof e[l];if(E==="string"){h+="'"+e[l]+"'",D=m+2,m++;break}if(E==="function"){h+=e[l].name||"<anonymous>",D=m+2,m++;break}h+=i(e[l]),D=m+2,m++;break;case 115:if(l>=f)break;D<m&&(h+=t.slice(D,m)),h+=String(e[l]),D=m+2,m++;break;case 37:D<m&&(h+=t.slice(D,m)),h+="%",D=m+2,m++,l--;break}++l}++m}return D===-1?t:(D<w&&(h+=t.slice(D)),h)}const zn=hc;var fr=Et;const lr=mc().console||{},lc={mapHttpRequest:Vr,mapHttpResponse:Vr,wrapRequestSerializer:xi,wrapResponseSerializer:xi,wrapErrorSerializer:xi,req:Vr,res:Vr,err:_c};function dc(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Et(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||lr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=dc(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const c=t.level||"info",f=Object.create(r);f.log||(f.log=dr),Object.defineProperty(f,"levelVal",{get:l}),Object.defineProperty(f,"level",{get:D,set:w});const h={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:bc(t)};f.levels=Et.levels,f.level=c,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=dr,f.serializers=i,f._serialize=n,f._stdErrSerialize=s,f.child=m,e&&(f._logEvent=Si());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function D(){return this._level}function w(E){if(E!=="silent"&&!this.levels.values[E])throw Error("unknown level "+E);this._level=E,ir(h,f,"error","log"),ir(h,f,"fatal","error"),ir(h,f,"warn","error"),ir(h,f,"info","log"),ir(h,f,"debug","log"),ir(h,f,"trace","log")}function m(E,F){if(!E)throw new Error("missing bindings for child Pino");F=F||{},n&&E.serializers&&(F.serializers=E.serializers);const N=F.serializers;if(n&&N){var B=Object.assign({},i,N),x=t.browser.serialize===!0?Object.keys(B):n;delete E.serializers,Kr([E],x,B,this._stdErrSerialize)}function P(y){this._childLevel=(y._childLevel|0)+1,this.error=nr(y,E,"error"),this.fatal=nr(y,E,"fatal"),this.warn=nr(y,E,"warn"),this.info=nr(y,E,"info"),this.debug=nr(y,E,"debug"),this.trace=nr(y,E,"trace"),B&&(this.serializers=B,this._serialize=x),e&&(this._logEvent=Si([].concat(y._logEvent.bindings,E)))}return P.prototype=this,new P(this)}return f}Et.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Et.stdSerializers=lc,Et.stdTimeFunctions=Object.assign({},{nullTime:Hn,epochTime:qn,unixTime:vc,isoTime:wc});function ir(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?dr:n[r]?n[r]:lr[r]||lr[i]||dr,pc(t,e,r)}function pc(t,e,r){!t.transmit&&e[r]===dr||(e[r]=function(i){return function(){const s=t.timestamp(),o=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===lr?lr:this;for(var f=0;f<o.length;f++)o[f]=arguments[f];if(t.serialize&&!t.asObject&&Kr(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(c,gc(this,r,o,s)):i.apply(c,o),t.transmit){const h=t.transmit.level||e.level,l=Et.levels.values[h],D=Et.levels.values[r];if(D<l)return;yc(this,{ts:s,methodLevel:r,methodValue:D,transmitLevel:h,transmitValue:Et.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function gc(t,e,r,i){t._serialize&&Kr(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let s=n[0];const o={};i&&(o.time=i),o.level=Et.levels.values[e];let c=(t._childLevel|0)+1;if(c<1&&(c=1),s!==null&&typeof s=="object"){for(;c--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?zn(n.shift(),n):void 0}else typeof s=="string"&&(s=zn(n.shift(),n));return s!==void 0&&(o.msg=s),o}function Kr(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=Et.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const s in t[n])e&&e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function nr(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function yc(t,e,r){const i=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,c=e.val,f=t._logEvent.bindings;Kr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(h){return f.indexOf(h)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,i(s,t._logEvent,c),t._logEvent=Si(f)}function Si(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function _c(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function bc(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Hn:qn}function Vr(){return{}}function xi(t){return t}function dr(){}function Hn(){return!1}function qn(){return Date.now()}function vc(){return Math.round(Date.now()/1e3)}function wc(){return new Date(Date.now()).toISOString()}function mc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var rt={exports:{}},sr=typeof Reflect=="object"?Reflect:null,Kn=sr&&typeof sr.apply=="function"?sr.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Gr;sr&&typeof sr.ownKeys=="function"?Gr=sr.ownKeys:Object.getOwnPropertySymbols?Gr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Gr=function(e){return Object.getOwnPropertyNames(e)};function Ec(t){console&&console.warn&&console.warn(t)}var Vn=Number.isNaN||function(e){return e!==e};function xe(){xe.init.call(this)}rt.exports=xe,rt.exports.once=Oc,xe.EventEmitter=xe,xe.prototype._events=void 0,xe.prototype._eventsCount=0,xe.prototype._maxListeners=void 0;var Gn=10;function Wr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(xe,"defaultMaxListeners",{enumerable:!0,get:function(){return Gn},set:function(t){if(typeof t!="number"||t<0||Vn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Gn=t}}),xe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wn(t){return t._maxListeners===void 0?xe.defaultMaxListeners:t._maxListeners}xe.prototype.getMaxListeners=function(){return Wn(this)},xe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var f=s[e];if(f===void 0)return!1;if(typeof f=="function")Kn(f,this,r);else for(var h=f.length,l=Zn(f,h),i=0;i<h;++i)Kn(l[i],this,r);return!0};function kn(t,e,r,i){var n,s,o;if(Wr(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),n=Wn(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,Ec(c)}return t}xe.prototype.addListener=function(e,r){return kn(this,e,r,!1)},xe.prototype.on=xe.prototype.addListener,xe.prototype.prependListener=function(e,r){return kn(this,e,r,!0)};function Dc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yn(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Dc.bind(i);return n.listener=r,i.wrapFn=n,n}xe.prototype.once=function(e,r){return Wr(r),this.on(e,Yn(this,e,r)),this},xe.prototype.prependOnceListener=function(e,r){return Wr(r),this.prependListener(e,Yn(this,e,r)),this},xe.prototype.removeListener=function(e,r){var i,n,s,o,c;if(Wr(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){c=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Sc(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},xe.prototype.off=xe.prototype.removeListener,xe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function Jn(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?xc(n):Zn(n,n.length)}xe.prototype.listeners=function(e){return Jn(this,e,!0)},xe.prototype.rawListeners=function(e){return Jn(this,e,!1)},xe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Xn.call(t,e)},xe.prototype.listenerCount=Xn;function Xn(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}xe.prototype.eventNames=function(){return this._eventsCount>0?Gr(this._events):[]};function Zn(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Sc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function xc(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Oc(t,e){return new Promise(function(r,i){function n(o){t.removeListener(e,s),i(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}Qn(t,e,s,{once:!0}),e!=="error"&&Ic(t,n,{once:!0})})}function Ic(t,e,r){typeof t.on=="function"&&Qn(t,"error",e,r)}function Qn(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var kr={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Oi=function(t,e){return Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Oi(t,e)};function Pc(t,e){Oi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ii=function(){return Ii=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ii.apply(this,arguments)};function Ac(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Tc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Cc(t,e){return function(r,i){e(r,i,t)}}function Rc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Nc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(D){o(D)}}function f(l){try{h(i.throw(l))}catch(D){o(D)}}function h(l){l.done?s(l.value):n(l.value).then(c,f)}h((i=i.apply(t,e||[])).next())})}function Fc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return f([h,l])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Lc(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Uc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Pi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function es(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function $c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(es(arguments[e]));return t}function Mc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function pr(t){return this instanceof pr?(this.v=t,this):new pr(t)}function jc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(w){i[w]&&(n[w]=function(m){return new Promise(function(E,F){s.push([w,m,E,F])>1||c(w,m)})})}function c(w,m){try{f(i[w](m))}catch(E){D(s[0][3],E)}}function f(w){w.value instanceof pr?Promise.resolve(w.value.v).then(h,l):D(s[0][2],w)}function h(w){c("next",w)}function l(w){c("throw",w)}function D(w,m){w(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Bc(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:pr(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function zc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Pi=="function"?Pi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,f){o=t[s](o),n(c,f,o.done,o.value)})}}function n(s,o,c,f){Promise.resolve(f).then(function(h){s({value:h,done:c})},o)}}function Hc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function qc(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Kc(t){return t&&t.__esModule?t:{default:t}}function Vc(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Gc(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Wc=Object.freeze({__proto__:null,__extends:Pc,get __assign(){return Ii},__rest:Ac,__decorate:Tc,__param:Cc,__metadata:Rc,__awaiter:Nc,__generator:Fc,__createBinding:Lc,__exportStar:Uc,__values:Pi,__read:es,__spread:$c,__spreadArrays:Mc,__await:pr,__asyncGenerator:jc,__asyncDelegator:Bc,__asyncValues:zc,__makeTemplateObject:Hc,__importStar:qc,__importDefault:Kc,__classPrivateFieldGet:Vc,__classPrivateFieldSet:Gc}),ts=Kt(Wc),gr={};Object.defineProperty(gr,"__esModule",{value:!0});function kc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}gr.safeJsonParse=kc;function Yc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}gr.safeJsonStringify=Yc;var yr={exports:{}},rs;function Jc(){return rs||(rs=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof qe<"u"&&qe.localStorage?yr.exports=qe.localStorage:typeof window<"u"&&window.localStorage?yr.exports=window.localStorage:yr.exports=new e}()),yr.exports}var Ai={},_r={},is;function Xc(){if(is)return _r;is=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.IKeyValueStorage=void 0;class t{}return _r.IKeyValueStorage=t,_r}var br={},ns;function Zc(){if(ns)return br;ns=1,Object.defineProperty(br,"__esModule",{value:!0}),br.parseEntry=void 0;const t=gr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return br.parseEntry=e,br}var ss;function Qc(){return ss||(ss=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ts;e.__exportStar(Xc(),t),e.__exportStar(Zc(),t)}(Ai)),Ai}Object.defineProperty(kr,"__esModule",{value:!0}),kr.KeyValueStorage=void 0;const or=ts,os=gr,eu=or.__importDefault(Jc()),tu=Qc();class as{constructor(){this.localStorage=eu.default}getKeys(){return or.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return or.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(tu.parseEntry)})}getItem(e){return or.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return os.safeJsonParse(r)})}setItem(e,r){return or.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,os.safeJsonStringify(r))})}removeItem(e){return or.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}kr.KeyValueStorage=as;var ru=kr.default=as,vr={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ti=function(t,e){return Ti=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ti(t,e)};function iu(t,e){Ti(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ci=function(){return Ci=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ci.apply(this,arguments)};function nu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function su(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function ou(t,e){return function(r,i){e(r,i,t)}}function au(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function cu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(D){o(D)}}function f(l){try{h(i.throw(l))}catch(D){o(D)}}function h(l){l.done?s(l.value):n(l.value).then(c,f)}h((i=i.apply(t,e||[])).next())})}function uu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return f([h,l])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function hu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function fu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ri(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cs(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function lu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(cs(arguments[e]));return t}function du(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function wr(t){return this instanceof wr?(this.v=t,this):new wr(t)}function pu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(w){i[w]&&(n[w]=function(m){return new Promise(function(E,F){s.push([w,m,E,F])>1||c(w,m)})})}function c(w,m){try{f(i[w](m))}catch(E){D(s[0][3],E)}}function f(w){w.value instanceof wr?Promise.resolve(w.value.v).then(h,l):D(s[0][2],w)}function h(w){c("next",w)}function l(w){c("throw",w)}function D(w,m){w(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function gu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:wr(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function yu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ri=="function"?Ri(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,f){o=t[s](o),n(c,f,o.done,o.value)})}}function n(s,o,c,f){Promise.resolve(f).then(function(h){s({value:h,done:c})},o)}}function _u(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function bu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function vu(t){return t&&t.__esModule?t:{default:t}}function wu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function mu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Eu=Object.freeze({__proto__:null,__extends:iu,get __assign(){return Ci},__rest:nu,__decorate:su,__param:ou,__metadata:au,__awaiter:cu,__generator:uu,__createBinding:hu,__exportStar:fu,__values:Ri,__read:cs,__spread:lu,__spreadArrays:du,__await:wr,__asyncGenerator:pu,__asyncDelegator:gu,__asyncValues:yu,__makeTemplateObject:_u,__importStar:bu,__importDefault:vu,__classPrivateFieldGet:wu,__classPrivateFieldSet:mu}),Yr=Kt(Eu),mr={},Z={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ni=function(t,e){return Ni=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ni(t,e)};function Du(t,e){Ni(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Fi=function(){return Fi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Fi.apply(this,arguments)};function Su(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function xu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Ou(t,e){return function(r,i){e(r,i,t)}}function Iu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Pu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(D){o(D)}}function f(l){try{h(i.throw(l))}catch(D){o(D)}}function h(l){l.done?s(l.value):n(l.value).then(c,f)}h((i=i.apply(t,e||[])).next())})}function Au(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return f([h,l])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Tu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Cu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Li(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function us(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function Ru(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(us(arguments[e]));return t}function Nu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function Er(t){return this instanceof Er?(this.v=t,this):new Er(t)}function Fu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(w){i[w]&&(n[w]=function(m){return new Promise(function(E,F){s.push([w,m,E,F])>1||c(w,m)})})}function c(w,m){try{f(i[w](m))}catch(E){D(s[0][3],E)}}function f(w){w.value instanceof Er?Promise.resolve(w.value.v).then(h,l):D(s[0][2],w)}function h(w){c("next",w)}function l(w){c("throw",w)}function D(w,m){w(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Lu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Er(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Uu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Li=="function"?Li(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,f){o=t[s](o),n(c,f,o.done,o.value)})}}function n(s,o,c,f){Promise.resolve(f).then(function(h){s({value:h,done:c})},o)}}function $u(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Mu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function ju(t){return t&&t.__esModule?t:{default:t}}function Bu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function zu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Hu=Object.freeze({__proto__:null,__extends:Du,get __assign(){return Fi},__rest:Su,__decorate:xu,__param:Ou,__metadata:Iu,__awaiter:Pu,__generator:Au,__createBinding:Tu,__exportStar:Cu,__values:Li,__read:us,__spread:Ru,__spreadArrays:Nu,__await:Er,__asyncGenerator:Fu,__asyncDelegator:Lu,__asyncValues:Uu,__makeTemplateObject:$u,__importStar:Mu,__importDefault:ju,__classPrivateFieldGet:Bu,__classPrivateFieldSet:zu}),Jr=Kt(Hu),Ui={},Dr={},hs;function qu(){if(hs)return Dr;hs=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Dr.delay=t,Dr}var Vt={},$i={},Gt={},fs;function Ku(){return fs||(fs=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ONE_THOUSAND=Gt.ONE_HUNDRED=void 0,Gt.ONE_HUNDRED=100,Gt.ONE_THOUSAND=1e3),Gt}var Mi={},ls;function Vu(){return ls||(ls=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Mi)),Mi}var ds;function ps(){return ds||(ds=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Jr;e.__exportStar(Ku(),t),e.__exportStar(Vu(),t)}($i)),$i}var gs;function Gu(){if(gs)return Vt;gs=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.fromMiliseconds=Vt.toMiliseconds=void 0;const t=ps();function e(i){return i*t.ONE_THOUSAND}Vt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Vt.fromMiliseconds=r,Vt}var ys;function Wu(){return ys||(ys=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Jr;e.__exportStar(qu(),t),e.__exportStar(Gu(),t)}(Ui)),Ui}var ar={},_s;function ku(){if(_s)return ar;_s=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ar.Watch=t,ar.default=t,ar}var ji={},Sr={},bs;function Yu(){if(bs)return Sr;bs=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.IWatch=void 0;class t{}return Sr.IWatch=t,Sr}var vs;function Ju(){return vs||(vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Jr.__exportStar(Yu(),t)}(ji)),ji}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Jr;e.__exportStar(Wu(),t),e.__exportStar(ku(),t),e.__exportStar(Ju(),t),e.__exportStar(ps(),t)})(Z);var Bi={},xr={};class Wt{}var Xu=Object.freeze({__proto__:null,IEvents:Wt}),Zu=Kt(Xu),ws;function Qu(){if(ws)return xr;ws=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.IHeartBeat=void 0;const t=Zu;class e extends t.IEvents{constructor(i){super()}}return xr.IHeartBeat=e,xr}var ms;function Es(){return ms||(ms=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Yr.__exportStar(Qu(),t)}(Bi)),Bi}var zi={},kt={},Ds;function eh(){if(Ds)return kt;Ds=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.HEARTBEAT_EVENTS=kt.HEARTBEAT_INTERVAL=void 0;const t=Z;return kt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},kt}var Ss;function xs(){return Ss||(Ss=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Yr.__exportStar(eh(),t)}(zi)),zi}var Os;function th(){if(Os)return mr;Os=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.HeartBeat=void 0;const t=Yr,e=rt.exports,r=Z,i=Es(),n=xs();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=c?.interval||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const f=new s(c);return yield f.init(),f})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,f){this.events.on(c,f)}once(c,f){this.events.once(c,f)}off(c,f){this.events.off(c,f)}removeListener(c,f){this.events.removeListener(c,f)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return mr.HeartBeat=s,mr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Yr;e.__exportStar(th(),t),e.__exportStar(Es(),t),e.__exportStar(xs(),t)})(vr);var Se={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Hi=function(t,e){return Hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Hi(t,e)};function rh(t,e){Hi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var qi=function(){return qi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},qi.apply(this,arguments)};function ih(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function nh(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function sh(t,e){return function(r,i){e(r,i,t)}}function oh(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function ah(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(D){o(D)}}function f(l){try{h(i.throw(l))}catch(D){o(D)}}function h(l){l.done?s(l.value):n(l.value).then(c,f)}h((i=i.apply(t,e||[])).next())})}function ch(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return f([h,l])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function uh(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function hh(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ki(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Is(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function fh(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Is(arguments[e]));return t}function lh(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function Or(t){return this instanceof Or?(this.v=t,this):new Or(t)}function dh(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(w){i[w]&&(n[w]=function(m){return new Promise(function(E,F){s.push([w,m,E,F])>1||c(w,m)})})}function c(w,m){try{f(i[w](m))}catch(E){D(s[0][3],E)}}function f(w){w.value instanceof Or?Promise.resolve(w.value.v).then(h,l):D(s[0][2],w)}function h(w){c("next",w)}function l(w){c("throw",w)}function D(w,m){w(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ph(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Or(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function gh(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ki=="function"?Ki(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,f){o=t[s](o),n(c,f,o.done,o.value)})}}function n(s,o,c,f){Promise.resolve(f).then(function(h){s({value:h,done:c})},o)}}function yh(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function _h(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function bh(t){return t&&t.__esModule?t:{default:t}}function vh(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function wh(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var mh=Object.freeze({__proto__:null,__extends:rh,get __assign(){return qi},__rest:ih,__decorate:nh,__param:sh,__metadata:oh,__awaiter:ah,__generator:ch,__createBinding:uh,__exportStar:hh,__values:Ki,__read:Is,__spread:fh,__spreadArrays:lh,__await:Or,__asyncGenerator:dh,__asyncDelegator:ph,__asyncValues:gh,__makeTemplateObject:yh,__importStar:_h,__importDefault:bh,__classPrivateFieldGet:vh,__classPrivateFieldSet:wh}),Eh=Kt(mh),Yt={},Ps;function As(){return Ps||(Ps=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.PINO_CUSTOM_CONTEXT_KEY=Yt.PINO_LOGGER_DEFAULTS=void 0,Yt.PINO_LOGGER_DEFAULTS={level:"info"},Yt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Yt}var ot={},Ts;function Dh(){if(Ts)return ot;Ts=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.generateChildLogger=ot.formatChildLoggerContext=ot.getLoggerContext=ot.setBrowserLoggerContext=ot.getBrowserLoggerContext=ot.getDefaultLoggerOptions=void 0;const t=As();function e(c){return Object.assign(Object.assign({},c),{level:c?.level||t.PINO_LOGGER_DEFAULTS.level})}ot.getDefaultLoggerOptions=e;function r(c,f=t.PINO_CUSTOM_CONTEXT_KEY){return c[f]||""}ot.getBrowserLoggerContext=r;function i(c,f,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]=f,c}ot.setBrowserLoggerContext=i;function n(c,f=t.PINO_CUSTOM_CONTEXT_KEY){let h="";return typeof c.bindings>"u"?h=r(c,f):h=c.bindings().context||"",h}ot.getLoggerContext=n;function s(c,f,h=t.PINO_CUSTOM_CONTEXT_KEY){const l=n(c,h);return l.trim()?`${l}/${f}`:f}ot.formatChildLoggerContext=s;function o(c,f,h=t.PINO_CUSTOM_CONTEXT_KEY){const l=s(c,f,h),D=c.child({context:l});return i(D,l,h)}return ot.generateChildLogger=o,ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Eh,r=e.__importDefault(fr);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(As(),t),e.__exportStar(Dh(),t)})(Se);class Sh extends Wt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class xh extends Wt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class Oh{constructor(e,r){this.logger=e,this.core=r}}class Ih extends Wt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Ph extends Wt{constructor(e){super()}}class Ah{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class Th extends Wt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Ch extends Wt{constructor(e,r){super(),this.core=e,this.logger=r}}class Rh{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Nh{constructor(e){this.client=e}}function Vi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}function Ir(t){return typeof t=="string"?t:JSON.stringify(t)}var Gi={},cr={},Xr={},Zr={};Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.BrowserRandomSource=void 0;const Cs=65536;class Fh{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Cs)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Cs)));return r}}Zr.BrowserRandomSource=Fh;function Lh(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qr={},lt={};Object.defineProperty(lt,"__esModule",{value:!0});function Uh(t){for(var e=0;e<t.length;e++)t[e]=0;return t}lt.wipe=Uh;var $h={},Mh=Object.freeze({__proto__:null,default:$h}),jh=Kt(Mh);Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.NodeRandomSource=void 0;const Bh=lt;class zh{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Lh<"u"){const e=jh;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Bh.wipe)(r),i}}Qr.NodeRandomSource=zh,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.SystemRandomSource=void 0;const Hh=Zr,qh=Qr;class Kh{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Hh.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new qh.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Xr.SystemRandomSource=Kh;var re={},Rs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,f){var h=c>>>16&65535,l=c&65535,D=f>>>16&65535,w=f&65535;return l*w+(h*w+l*D<<16>>>0)|0}t.mul=Math.imul||e;function r(c,f){return c+f|0}t.add=r;function i(c,f){return c-f|0}t.sub=i;function n(c,f){return c<<f|c>>>32-f}t.rotl=n;function s(c,f){return c<<32-f|c>>>f}t.rotr=s;function o(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||o,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Rs),Object.defineProperty(re,"__esModule",{value:!0});var Ns=Rs;function Vh(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=Vh;function Gh(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=Gh;function Wh(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=Wh;function kh(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=kh;function Fs(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=Fs,re.writeInt16BE=Fs;function Ls(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=Ls,re.writeInt16LE=Ls;function Wi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=Wi;function ki(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=ki;function Yi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=Yi;function Ji(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Ji;function ei(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=ei,re.writeInt32BE=ei;function ti(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=ti,re.writeInt32LE=ti;function Yh(t,e){e===void 0&&(e=0);var r=Wi(t,e),i=Wi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Yh;function Jh(t,e){e===void 0&&(e=0);var r=ki(t,e),i=ki(t,e+4);return r*4294967296+i}re.readUint64BE=Jh;function Xh(t,e){e===void 0&&(e=0);var r=Yi(t,e),i=Yi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=Xh;function Zh(t,e){e===void 0&&(e=0);var r=Ji(t,e),i=Ji(t,e+4);return i*4294967296+r}re.readUint64LE=Zh;function Us(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ei(t/4294967296>>>0,e,r),ei(t>>>0,e,r+4),e}re.writeUint64BE=Us,re.writeInt64BE=Us;function $s(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ti(t>>>0,e,r),ti(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=$s,re.writeInt64LE=$s;function Qh(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}re.readUintBE=Qh;function ef(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}re.readUintLE=ef;function tf(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Ns.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}re.writeUintBE=tf;function rf(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Ns.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}re.writeUintLE=rf;function nf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=nf;function sf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=sf;function of(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=of;function af(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=af;function cf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=cf;function uf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=uf;function hf(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=hf;function ff(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=ff,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Xr,r=re,i=lt;t.defaultRandomSource=new e.SystemRandomSource;function n(h,l=t.defaultRandomSource){return l.randomBytes(h)}t.randomBytes=n;function s(h=t.defaultRandomSource){const l=n(4,h),D=(0,r.readUint32LE)(l);return(0,i.wipe)(l),D}t.randomUint32=s;const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(h,l=o,D=t.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let w="";const m=l.length,E=256-256%m;for(;h>0;){const F=n(Math.ceil(h*256/E),D);for(let N=0;N<F.length&&h>0;N++){const B=F[N];B<E&&(w+=l.charAt(B%m),h--)}(0,i.wipe)(F)}return w}t.randomString=c;function f(h,l=o,D=t.defaultRandomSource){const w=Math.ceil(h/(Math.log(l.length)/Math.LN2));return c(w,l,D)}t.randomStringForEntropy=f}(cr);var Ms={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=lt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(f,h){if(h===void 0&&(h=f.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var l=0;if(this._bytesHashed+=h,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&h>0;)this._buffer[this._bufferLength++]=f[l++],h--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(h>=this.blockSize&&(l=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,f,l,h),h%=this.blockSize);h>0;)this._buffer[this._bufferLength++]=f[l++],h--;return this},c.prototype.finish=function(f){if(!this._finished){var h=this._bytesHashed,l=this._bufferLength,D=h/536870912|0,w=h<<3,m=h%128<112?128:256;this._buffer[l]=128;for(var E=l+1;E<m-8;E++)this._buffer[E]=0;e.writeUint32BE(D,this._buffer,m-8),e.writeUint32BE(w,this._buffer,m-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,m),this._finished=!0}for(var E=0;E<this.digestLength/8;E++)e.writeUint32BE(this._stateHi[E],f,E*8),e.writeUint32BE(this._stateLo[E],f,E*8+4);return this},c.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(f){return this._stateHi.set(f.stateHi),this._stateLo.set(f.stateLo),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(f){r.wipe(f.stateHi),r.wipe(f.stateLo),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},c}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(c,f,h,l,D,w,m){for(var E=h[0],F=h[1],N=h[2],B=h[3],x=h[4],P=h[5],y=h[6],S=h[7],v=l[0],a=l[1],d=l[2],M=l[3],H=l[4],G=l[5],J=l[6],X=l[7],g,_,U,$,R,C,j,z;m>=128;){for(var Q=0;Q<16;Q++){var q=8*Q+w;c[Q]=e.readUint32BE(D,q),f[Q]=e.readUint32BE(D,q+4)}for(var Q=0;Q<80;Q++){var ee=E,Y=F,ae=N,T=B,A=x,O=P,u=y,b=S,K=v,W=a,fe=d,_e=M,de=H,we=G,Le=J,Te=X;if(g=S,_=X,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=(x>>>14|H<<32-14)^(x>>>18|H<<32-18)^(H>>>41-32|x<<32-(41-32)),_=(H>>>14|x<<32-14)^(H>>>18|x<<32-18)^(x>>>41-32|H<<32-(41-32)),R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,g=x&P^~x&y,_=H&G^~H&J,R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,g=n[Q*2],_=n[Q*2+1],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,g=c[Q%16],_=f[Q%16],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,U=j&65535|z<<16,$=R&65535|C<<16,g=U,_=$,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=(E>>>28|v<<32-28)^(v>>>34-32|E<<32-(34-32))^(v>>>39-32|E<<32-(39-32)),_=(v>>>28|E<<32-28)^(E>>>34-32|v<<32-(34-32))^(E>>>39-32|v<<32-(39-32)),R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,g=E&F^E&N^F&N,_=v&a^v&d^a&d,R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,b=j&65535|z<<16,Te=R&65535|C<<16,g=T,_=_e,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=U,_=$,R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,T=j&65535|z<<16,_e=R&65535|C<<16,F=ee,N=Y,B=ae,x=T,P=A,y=O,S=u,E=b,a=K,d=W,M=fe,H=_e,G=de,J=we,X=Le,v=Te,Q%16===15)for(var q=0;q<16;q++)g=c[q],_=f[q],R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=c[(q+9)%16],_=f[(q+9)%16],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,U=c[(q+1)%16],$=f[(q+1)%16],g=(U>>>1|$<<32-1)^(U>>>8|$<<32-8)^U>>>7,_=($>>>1|U<<32-1)^($>>>8|U<<32-8)^($>>>7|U<<32-7),R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,U=c[(q+14)%16],$=f[(q+14)%16],g=(U>>>19|$<<32-19)^($>>>61-32|U<<32-(61-32))^U>>>6,_=($>>>19|U<<32-19)^(U>>>61-32|$<<32-(61-32))^($>>>6|U<<32-6),R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,c[q]=j&65535|z<<16,f[q]=R&65535|C<<16}g=E,_=v,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[0],_=l[0],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[0]=E=j&65535|z<<16,l[0]=v=R&65535|C<<16,g=F,_=a,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[1],_=l[1],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[1]=F=j&65535|z<<16,l[1]=a=R&65535|C<<16,g=N,_=d,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[2],_=l[2],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[2]=N=j&65535|z<<16,l[2]=d=R&65535|C<<16,g=B,_=M,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[3],_=l[3],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[3]=B=j&65535|z<<16,l[3]=M=R&65535|C<<16,g=x,_=H,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[4],_=l[4],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[4]=x=j&65535|z<<16,l[4]=H=R&65535|C<<16,g=P,_=G,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[5],_=l[5],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[5]=P=j&65535|z<<16,l[5]=G=R&65535|C<<16,g=y,_=J,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[6],_=l[6],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[6]=y=j&65535|z<<16,l[6]=J=R&65535|C<<16,g=S,_=X,R=_&65535,C=_>>>16,j=g&65535,z=g>>>16,g=h[7],_=l[7],R+=_&65535,C+=_>>>16,j+=g&65535,z+=g>>>16,C+=R>>>16,j+=C>>>16,z+=j>>>16,h[7]=S=j&65535|z<<16,l[7]=X=R&65535|C<<16,w+=128,m-=128}return w}function o(c){var f=new i;f.update(c);var h=f.digest();return f.clean(),h}t.hash=o})(Ms),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=cr,r=Ms,i=lt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(T){const A=new Float64Array(16);if(T)for(let O=0;O<T.length;O++)A[O]=T[O];return A}const s=new Uint8Array(32);s[0]=9;const o=n(),c=n([1]),f=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),h=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),l=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),D=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),w=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function m(T,A){for(let O=0;O<16;O++)T[O]=A[O]|0}function E(T){let A=1;for(let O=0;O<16;O++){let u=T[O]+A+65535;A=Math.floor(u/65536),T[O]=u-A*65536}T[0]+=A-1+37*(A-1)}function F(T,A,O){const u=~(O-1);for(let b=0;b<16;b++){const K=u&(T[b]^A[b]);T[b]^=K,A[b]^=K}}function N(T,A){const O=n(),u=n();for(let b=0;b<16;b++)u[b]=A[b];E(u),E(u),E(u);for(let b=0;b<2;b++){O[0]=u[0]-65517;for(let W=1;W<15;W++)O[W]=u[W]-65535-(O[W-1]>>16&1),O[W-1]&=65535;O[15]=u[15]-32767-(O[14]>>16&1);const K=O[15]>>16&1;O[14]&=65535,F(u,O,1-K)}for(let b=0;b<16;b++)T[2*b]=u[b]&255,T[2*b+1]=u[b]>>8}function B(T,A){let O=0;for(let u=0;u<32;u++)O|=T[u]^A[u];return(1&O-1>>>8)-1}function x(T,A){const O=new Uint8Array(32),u=new Uint8Array(32);return N(O,T),N(u,A),B(O,u)}function P(T){const A=new Uint8Array(32);return N(A,T),A[0]&1}function y(T,A){for(let O=0;O<16;O++)T[O]=A[2*O]+(A[2*O+1]<<8);T[15]&=32767}function S(T,A,O){for(let u=0;u<16;u++)T[u]=A[u]+O[u]}function v(T,A,O){for(let u=0;u<16;u++)T[u]=A[u]-O[u]}function a(T,A,O){let u,b,K=0,W=0,fe=0,_e=0,de=0,we=0,Le=0,Te=0,ye=0,pe=0,le=0,ue=0,ce=0,oe=0,se=0,te=0,he=0,ge=0,ie=0,be=0,ve=0,Ee=0,De=0,me=0,wt=0,It=0,jt=0,dt=0,Qt=0,zr=0,_i=0,Ue=O[0],Ce=O[1],$e=O[2],Me=O[3],je=O[4],Re=O[5],Ke=O[6],Ve=O[7],Ge=O[8],We=O[9],ke=O[10],He=O[11],Be=O[12],Pe=O[13],Ye=O[14],Je=O[15];u=A[0],K+=u*Ue,W+=u*Ce,fe+=u*$e,_e+=u*Me,de+=u*je,we+=u*Re,Le+=u*Ke,Te+=u*Ve,ye+=u*Ge,pe+=u*We,le+=u*ke,ue+=u*He,ce+=u*Be,oe+=u*Pe,se+=u*Ye,te+=u*Je,u=A[1],W+=u*Ue,fe+=u*Ce,_e+=u*$e,de+=u*Me,we+=u*je,Le+=u*Re,Te+=u*Ke,ye+=u*Ve,pe+=u*Ge,le+=u*We,ue+=u*ke,ce+=u*He,oe+=u*Be,se+=u*Pe,te+=u*Ye,he+=u*Je,u=A[2],fe+=u*Ue,_e+=u*Ce,de+=u*$e,we+=u*Me,Le+=u*je,Te+=u*Re,ye+=u*Ke,pe+=u*Ve,le+=u*Ge,ue+=u*We,ce+=u*ke,oe+=u*He,se+=u*Be,te+=u*Pe,he+=u*Ye,ge+=u*Je,u=A[3],_e+=u*Ue,de+=u*Ce,we+=u*$e,Le+=u*Me,Te+=u*je,ye+=u*Re,pe+=u*Ke,le+=u*Ve,ue+=u*Ge,ce+=u*We,oe+=u*ke,se+=u*He,te+=u*Be,he+=u*Pe,ge+=u*Ye,ie+=u*Je,u=A[4],de+=u*Ue,we+=u*Ce,Le+=u*$e,Te+=u*Me,ye+=u*je,pe+=u*Re,le+=u*Ke,ue+=u*Ve,ce+=u*Ge,oe+=u*We,se+=u*ke,te+=u*He,he+=u*Be,ge+=u*Pe,ie+=u*Ye,be+=u*Je,u=A[5],we+=u*Ue,Le+=u*Ce,Te+=u*$e,ye+=u*Me,pe+=u*je,le+=u*Re,ue+=u*Ke,ce+=u*Ve,oe+=u*Ge,se+=u*We,te+=u*ke,he+=u*He,ge+=u*Be,ie+=u*Pe,be+=u*Ye,ve+=u*Je,u=A[6],Le+=u*Ue,Te+=u*Ce,ye+=u*$e,pe+=u*Me,le+=u*je,ue+=u*Re,ce+=u*Ke,oe+=u*Ve,se+=u*Ge,te+=u*We,he+=u*ke,ge+=u*He,ie+=u*Be,be+=u*Pe,ve+=u*Ye,Ee+=u*Je,u=A[7],Te+=u*Ue,ye+=u*Ce,pe+=u*$e,le+=u*Me,ue+=u*je,ce+=u*Re,oe+=u*Ke,se+=u*Ve,te+=u*Ge,he+=u*We,ge+=u*ke,ie+=u*He,be+=u*Be,ve+=u*Pe,Ee+=u*Ye,De+=u*Je,u=A[8],ye+=u*Ue,pe+=u*Ce,le+=u*$e,ue+=u*Me,ce+=u*je,oe+=u*Re,se+=u*Ke,te+=u*Ve,he+=u*Ge,ge+=u*We,ie+=u*ke,be+=u*He,ve+=u*Be,Ee+=u*Pe,De+=u*Ye,me+=u*Je,u=A[9],pe+=u*Ue,le+=u*Ce,ue+=u*$e,ce+=u*Me,oe+=u*je,se+=u*Re,te+=u*Ke,he+=u*Ve,ge+=u*Ge,ie+=u*We,be+=u*ke,ve+=u*He,Ee+=u*Be,De+=u*Pe,me+=u*Ye,wt+=u*Je,u=A[10],le+=u*Ue,ue+=u*Ce,ce+=u*$e,oe+=u*Me,se+=u*je,te+=u*Re,he+=u*Ke,ge+=u*Ve,ie+=u*Ge,be+=u*We,ve+=u*ke,Ee+=u*He,De+=u*Be,me+=u*Pe,wt+=u*Ye,It+=u*Je,u=A[11],ue+=u*Ue,ce+=u*Ce,oe+=u*$e,se+=u*Me,te+=u*je,he+=u*Re,ge+=u*Ke,ie+=u*Ve,be+=u*Ge,ve+=u*We,Ee+=u*ke,De+=u*He,me+=u*Be,wt+=u*Pe,It+=u*Ye,jt+=u*Je,u=A[12],ce+=u*Ue,oe+=u*Ce,se+=u*$e,te+=u*Me,he+=u*je,ge+=u*Re,ie+=u*Ke,be+=u*Ve,ve+=u*Ge,Ee+=u*We,De+=u*ke,me+=u*He,wt+=u*Be,It+=u*Pe,jt+=u*Ye,dt+=u*Je,u=A[13],oe+=u*Ue,se+=u*Ce,te+=u*$e,he+=u*Me,ge+=u*je,ie+=u*Re,be+=u*Ke,ve+=u*Ve,Ee+=u*Ge,De+=u*We,me+=u*ke,wt+=u*He,It+=u*Be,jt+=u*Pe,dt+=u*Ye,Qt+=u*Je,u=A[14],se+=u*Ue,te+=u*Ce,he+=u*$e,ge+=u*Me,ie+=u*je,be+=u*Re,ve+=u*Ke,Ee+=u*Ve,De+=u*Ge,me+=u*We,wt+=u*ke,It+=u*He,jt+=u*Be,dt+=u*Pe,Qt+=u*Ye,zr+=u*Je,u=A[15],te+=u*Ue,he+=u*Ce,ge+=u*$e,ie+=u*Me,be+=u*je,ve+=u*Re,Ee+=u*Ke,De+=u*Ve,me+=u*Ge,wt+=u*We,It+=u*ke,jt+=u*He,dt+=u*Be,Qt+=u*Pe,zr+=u*Ye,_i+=u*Je,K+=38*he,W+=38*ge,fe+=38*ie,_e+=38*be,de+=38*ve,we+=38*Ee,Le+=38*De,Te+=38*me,ye+=38*wt,pe+=38*It,le+=38*jt,ue+=38*dt,ce+=38*Qt,oe+=38*zr,se+=38*_i,b=1,u=K+b+65535,b=Math.floor(u/65536),K=u-b*65536,u=W+b+65535,b=Math.floor(u/65536),W=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=_e+b+65535,b=Math.floor(u/65536),_e=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=we+b+65535,b=Math.floor(u/65536),we=u-b*65536,u=Le+b+65535,b=Math.floor(u/65536),Le=u-b*65536,u=Te+b+65535,b=Math.floor(u/65536),Te=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=le+b+65535,b=Math.floor(u/65536),le=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=se+b+65535,b=Math.floor(u/65536),se=u-b*65536,u=te+b+65535,b=Math.floor(u/65536),te=u-b*65536,K+=b-1+37*(b-1),b=1,u=K+b+65535,b=Math.floor(u/65536),K=u-b*65536,u=W+b+65535,b=Math.floor(u/65536),W=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=_e+b+65535,b=Math.floor(u/65536),_e=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=we+b+65535,b=Math.floor(u/65536),we=u-b*65536,u=Le+b+65535,b=Math.floor(u/65536),Le=u-b*65536,u=Te+b+65535,b=Math.floor(u/65536),Te=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=le+b+65535,b=Math.floor(u/65536),le=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=se+b+65535,b=Math.floor(u/65536),se=u-b*65536,u=te+b+65535,b=Math.floor(u/65536),te=u-b*65536,K+=b-1+37*(b-1),T[0]=K,T[1]=W,T[2]=fe,T[3]=_e,T[4]=de,T[5]=we,T[6]=Le,T[7]=Te,T[8]=ye,T[9]=pe,T[10]=le,T[11]=ue,T[12]=ce,T[13]=oe,T[14]=se,T[15]=te}function d(T,A){a(T,A,A)}function M(T,A){const O=n();let u;for(u=0;u<16;u++)O[u]=A[u];for(u=253;u>=0;u--)d(O,O),u!==2&&u!==4&&a(O,O,A);for(u=0;u<16;u++)T[u]=O[u]}function H(T,A){const O=n();let u;for(u=0;u<16;u++)O[u]=A[u];for(u=250;u>=0;u--)d(O,O),u!==1&&a(O,O,A);for(u=0;u<16;u++)T[u]=O[u]}function G(T,A){const O=n(),u=n(),b=n(),K=n(),W=n(),fe=n(),_e=n(),de=n(),we=n();v(O,T[1],T[0]),v(we,A[1],A[0]),a(O,O,we),S(u,T[0],T[1]),S(we,A[0],A[1]),a(u,u,we),a(b,T[3],A[3]),a(b,b,h),a(K,T[2],A[2]),S(K,K,K),v(W,u,O),v(fe,K,b),S(_e,K,b),S(de,u,O),a(T[0],W,fe),a(T[1],de,_e),a(T[2],_e,fe),a(T[3],W,de)}function J(T,A,O){for(let u=0;u<4;u++)F(T[u],A[u],O)}function X(T,A){const O=n(),u=n(),b=n();M(b,A[2]),a(O,A[0],b),a(u,A[1],b),N(T,u),T[31]^=P(O)<<7}function g(T,A,O){m(T[0],o),m(T[1],c),m(T[2],c),m(T[3],o);for(let u=255;u>=0;--u){const b=O[u/8|0]>>(u&7)&1;J(T,A,b),G(A,T),G(T,T),J(T,A,b)}}function _(T,A){const O=[n(),n(),n(),n()];m(O[0],l),m(O[1],D),m(O[2],c),a(O[3],l,D),g(T,O,A)}function U(T){if(T.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const A=(0,r.hash)(T);A[0]&=248,A[31]&=127,A[31]|=64;const O=new Uint8Array(32),u=[n(),n(),n(),n()];_(u,A),X(O,u);const b=new Uint8Array(64);return b.set(T),b.set(O,32),{publicKey:O,secretKey:b}}t.generateKeyPairFromSeed=U;function $(T){const A=(0,e.randomBytes)(32,T),O=U(A);return(0,i.wipe)(A),O}t.generateKeyPair=$;function R(T){if(T.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}t.extractPublicKeyFromSecretKey=R;const C=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function j(T,A){let O,u,b,K;for(u=63;u>=32;--u){for(O=0,b=u-32,K=u-12;b<K;++b)A[b]+=O-16*A[u]*C[b-(u-32)],O=Math.floor((A[b]+128)/256),A[b]-=O*256;A[b]+=O,A[u]=0}for(O=0,b=0;b<32;b++)A[b]+=O-(A[31]>>4)*C[b],O=A[b]>>8,A[b]&=255;for(b=0;b<32;b++)A[b]-=O*C[b];for(u=0;u<32;u++)A[u+1]+=A[u]>>8,T[u]=A[u]&255}function z(T){const A=new Float64Array(64);for(let O=0;O<64;O++)A[O]=T[O];for(let O=0;O<64;O++)T[O]=0;j(T,A)}function Q(T,A){const O=new Float64Array(64),u=[n(),n(),n(),n()],b=(0,r.hash)(T.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const K=new Uint8Array(64);K.set(b.subarray(32),32);const W=new r.SHA512;W.update(K.subarray(32)),W.update(A);const fe=W.digest();W.clean(),z(fe),_(u,fe),X(K,u),W.reset(),W.update(K.subarray(0,32)),W.update(T.subarray(32)),W.update(A);const _e=W.digest();z(_e);for(let de=0;de<32;de++)O[de]=fe[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)O[de+we]+=_e[de]*b[we];return j(K.subarray(32),O),K}t.sign=Q;function q(T,A){const O=n(),u=n(),b=n(),K=n(),W=n(),fe=n(),_e=n();return m(T[2],c),y(T[1],A),d(b,T[1]),a(K,b,f),v(b,b,T[2]),S(K,T[2],K),d(W,K),d(fe,W),a(_e,fe,W),a(O,_e,b),a(O,O,K),H(O,O),a(O,O,b),a(O,O,K),a(O,O,K),a(T[0],O,K),d(u,T[0]),a(u,u,K),x(u,b)&&a(T[0],T[0],w),d(u,T[0]),a(u,u,K),x(u,b)?-1:(P(T[0])===A[31]>>7&&v(T[0],o,T[0]),a(T[3],T[0],T[1]),0)}function ee(T,A,O){const u=new Uint8Array(32),b=[n(),n(),n(),n()],K=[n(),n(),n(),n()];if(O.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(q(K,T))return!1;const W=new r.SHA512;W.update(O.subarray(0,32)),W.update(T),W.update(A);const fe=W.digest();return z(fe),g(b,K,fe),_(K,O.subarray(32)),G(b,K),X(u,b),!B(O,u)}t.verify=ee;function Y(T){let A=[n(),n(),n(),n()];if(q(A,T))throw new Error("Ed25519: invalid public key");let O=n(),u=n(),b=A[1];S(O,c,b),v(u,c,b),M(u,u),a(O,O,u);let K=new Uint8Array(32);return N(K,O),K}t.convertPublicKeyToX25519=Y;function ae(T){const A=(0,r.hash)(T.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const O=new Uint8Array(A.subarray(0,32));return(0,i.wipe)(A),O}t.convertSecretKeyToX25519=ae}(Gi);const lf="EdDSA",df="JWT",js=".",Bs="base64url",pf="utf8",gf="utf8",yf=":",_f="did",bf="key",zs="base58btc",vf="z",wf="K36",mf=32;function Hs(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Xi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Hs(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return r}function Ef(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var c=t.length,f=t.charAt(0),h=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function D(E){if(E instanceof Uint8Array||(ArrayBuffer.isView(E)?E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength):Array.isArray(E)&&(E=Uint8Array.from(E))),!(E instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(E.length===0)return"";for(var F=0,N=0,B=0,x=E.length;B!==x&&E[B]===0;)B++,F++;for(var P=(x-B)*l+1>>>0,y=new Uint8Array(P);B!==x;){for(var S=E[B],v=0,a=P-1;(S!==0||v<N)&&a!==-1;a--,v++)S+=256*y[a]>>>0,y[a]=S%c>>>0,S=S/c>>>0;if(S!==0)throw new Error("Non-zero carry");N=v,B++}for(var d=P-N;d!==P&&y[d]===0;)d++;for(var M=f.repeat(F);d<P;++d)M+=t.charAt(y[d]);return M}function w(E){if(typeof E!="string")throw new TypeError("Expected String");if(E.length===0)return new Uint8Array;var F=0;if(E[F]!==" "){for(var N=0,B=0;E[F]===f;)N++,F++;for(var x=(E.length-F)*h+1>>>0,P=new Uint8Array(x);E[F];){var y=r[E.charCodeAt(F)];if(y===255)return;for(var S=0,v=x-1;(y!==0||S<B)&&v!==-1;v--,S++)y+=c*P[v]>>>0,P[v]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");B=S,F++}if(E[F]!==" "){for(var a=x-B;a!==x&&P[a]===0;)a++;for(var d=new Uint8Array(N+(x-a)),M=N;a!==x;)d[M++]=P[a++];return d}}}function m(E){var F=w(E);if(F)return F;throw new Error(`Non-${e} character`)}return{encode:D,decodeUnsafe:w,decode:m}}var Df=Ef,Sf=Df;const qs=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},xf=t=>new TextEncoder().encode(t),Of=t=>new TextDecoder().decode(t);class If{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Pf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ks(this,e)}}class Af{constructor(e){this.decoders=e}or(e){return Ks(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ks=(t,e)=>new Af({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Tf{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new If(e,r,i),this.decoder=new Pf(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:t,prefix:e,encode:r,decode:i})=>new Tf(t,e,r,i),Pr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Sf(r,e);return ri({prefix:t,name:e,encode:i,decode:s=>qs(n(s))})},Cf=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let c=0,f=0,h=0;for(let l=0;l<s;++l){const D=n[t[l]];if(D===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|D,c+=r,c>=8&&(c-=8,o[h++]=255&f>>c)}if(c>=r||255&f<<8-c)throw new SyntaxError("Unexpected end of data");return o},Rf=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,c=0;for(let f=0;f<t.length;++f)for(c=c<<8|t[f],o+=8;o>r;)o-=r,s+=e[n&c>>o];if(o&&(s+=e[n&c<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Ze=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ri({prefix:e,name:t,encode(n){return Rf(n,i,r)},decode(n){return Cf(n,i,r,t)}}),Nf=ri({prefix:"\0",name:"identity",encode:t=>Of(t),decode:t=>xf(t)});var Ff=Object.freeze({__proto__:null,identity:Nf});const Lf=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Uf=Object.freeze({__proto__:null,base2:Lf});const $f=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Mf=Object.freeze({__proto__:null,base8:$f});const jf=Pr({prefix:"9",name:"base10",alphabet:"0123456789"});var Bf=Object.freeze({__proto__:null,base10:jf});const zf=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Hf=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var qf=Object.freeze({__proto__:null,base16:zf,base16upper:Hf});const Kf=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Vf=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gf=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Wf=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kf=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Yf=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Jf=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xf=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zf=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qf=Object.freeze({__proto__:null,base32:Kf,base32upper:Vf,base32pad:Gf,base32padupper:Wf,base32hex:kf,base32hexupper:Yf,base32hexpad:Jf,base32hexpadupper:Xf,base32z:Zf});const el=Pr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),tl=Pr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var rl=Object.freeze({__proto__:null,base36:el,base36upper:tl});const il=Pr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),nl=Pr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var sl=Object.freeze({__proto__:null,base58btc:il,base58flickr:nl});const ol=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),al=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),cl=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ul=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var hl=Object.freeze({__proto__:null,base64:ol,base64pad:al,base64url:cl,base64urlpad:ul});const Vs=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),fl=Vs.reduce((t,e,r)=>(t[r]=e,t),[]),ll=Vs.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function dl(t){return t.reduce((e,r)=>(e+=fl[r],e),"")}function pl(t){const e=[];for(const r of t){const i=ll[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const gl=ri({prefix:"\u{1F680}",name:"base256emoji",encode:dl,decode:pl});var yl=Object.freeze({__proto__:null,base256emoji:gl}),_l=Ws,Gs=128,bl=127,vl=~bl,wl=Math.pow(2,31);function Ws(t,e,r){e=e||[],r=r||0;for(var i=r;t>=wl;)e[r++]=t&255|Gs,t/=128;for(;t&vl;)e[r++]=t&255|Gs,t>>>=7;return e[r]=t|0,Ws.bytes=r-i+1,e}var ml=Zi,El=128,ks=127;function Zi(t,i){var r=0,i=i||0,n=0,s=i,o,c=t.length;do{if(s>=c)throw Zi.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&ks)<<n:(o&ks)*Math.pow(2,n),n+=7}while(o>=El);return Zi.bytes=s-i,r}var Dl=Math.pow(2,7),Sl=Math.pow(2,14),xl=Math.pow(2,21),Ol=Math.pow(2,28),Il=Math.pow(2,35),Pl=Math.pow(2,42),Al=Math.pow(2,49),Tl=Math.pow(2,56),Cl=Math.pow(2,63),Rl=function(t){return t<Dl?1:t<Sl?2:t<xl?3:t<Ol?4:t<Il?5:t<Pl?6:t<Al?7:t<Tl?8:t<Cl?9:10},Nl={encode:_l,decode:ml,encodingLength:Rl},Ys=Nl;const Js=(t,e,r=0)=>(Ys.encode(t,e,r),e),Xs=t=>Ys.encodingLength(t),Qi=(t,e)=>{const r=e.byteLength,i=Xs(t),n=i+Xs(r),s=new Uint8Array(n+r);return Js(t,s,0),Js(r,s,i),s.set(e,n),new Fl(t,r,e,s)};class Fl{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Zs=({name:t,code:e,encode:r})=>new Ll(t,e,r);class Ll{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Qi(this.code,r):r.then(i=>Qi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Qs=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Ul=Zs({name:"sha2-256",code:18,encode:Qs("SHA-256")}),$l=Zs({name:"sha2-512",code:19,encode:Qs("SHA-512")});var Ml=Object.freeze({__proto__:null,sha256:Ul,sha512:$l});const eo=0,jl="identity",to=qs;var Bl=Object.freeze({__proto__:null,identity:{code:eo,name:jl,encode:to,digest:t=>Qi(eo,to(t))}});new TextEncoder,new TextDecoder;const ro={...Ff,...Uf,...Mf,...Bf,...qf,...Qf,...rl,...sl,...hl,...yl};({...Ml,...Bl});function io(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const no=io("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),en=io("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Hs(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),so={utf8:no,"utf-8":no,hex:ro.base16,latin1:en,ascii:en,binary:en,...ro};function ct(t,e="utf8"){const r=so[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ut(t,e="utf8"){const r=so[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function ii(t){return ct(ut(Ir(t),pf),Bs)}function oo(t){const e=ut(wf,zs),r=vf+ct(Xi([e,t]),zs);return[_f,bf,r].join(yf)}function zl(t){return ct(t,Bs)}function Hl(t){return ut([ii(t.header),ii(t.payload)].join(js),gf)}function ql(t){return[ii(t.header),ii(t.payload),zl(t.signature)].join(js)}function ao(t=cr.randomBytes(mf)){return Gi.generateKeyPairFromSeed(t)}async function Kl(t,e,r,i,n=Z.fromMiliseconds(Date.now())){const s={alg:lf,typ:df},o=oo(i.publicKey),c=n+r,f={iss:o,sub:t,aud:e,iat:n,exp:c},h=Hl({header:s,payload:f}),l=Gi.sign(i.secretKey,h);return ql({header:s,payload:f,signature:l})}var tn={},ni={};Object.defineProperty(ni,"__esModule",{value:!0});var it=re,rn=lt,Vl=20;function Gl(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,o=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],f=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],D=r[19]<<24|r[18]<<16|r[17]<<8|r[16],w=r[23]<<24|r[22]<<16|r[21]<<8|r[20],m=r[27]<<24|r[26]<<16|r[25]<<8|r[24],E=r[31]<<24|r[30]<<16|r[29]<<8|r[28],F=e[3]<<24|e[2]<<16|e[1]<<8|e[0],N=e[7]<<24|e[6]<<16|e[5]<<8|e[4],B=e[11]<<24|e[10]<<16|e[9]<<8|e[8],x=e[15]<<24|e[14]<<16|e[13]<<8|e[12],P=i,y=n,S=s,v=o,a=c,d=f,M=h,H=l,G=D,J=w,X=m,g=E,_=F,U=N,$=B,R=x,C=0;C<Vl;C+=2)P=P+a|0,_^=P,_=_>>>32-16|_<<16,G=G+_|0,a^=G,a=a>>>32-12|a<<12,y=y+d|0,U^=y,U=U>>>32-16|U<<16,J=J+U|0,d^=J,d=d>>>32-12|d<<12,S=S+M|0,$^=S,$=$>>>32-16|$<<16,X=X+$|0,M^=X,M=M>>>32-12|M<<12,v=v+H|0,R^=v,R=R>>>32-16|R<<16,g=g+R|0,H^=g,H=H>>>32-12|H<<12,S=S+M|0,$^=S,$=$>>>32-8|$<<8,X=X+$|0,M^=X,M=M>>>32-7|M<<7,v=v+H|0,R^=v,R=R>>>32-8|R<<8,g=g+R|0,H^=g,H=H>>>32-7|H<<7,y=y+d|0,U^=y,U=U>>>32-8|U<<8,J=J+U|0,d^=J,d=d>>>32-7|d<<7,P=P+a|0,_^=P,_=_>>>32-8|_<<8,G=G+_|0,a^=G,a=a>>>32-7|a<<7,P=P+d|0,R^=P,R=R>>>32-16|R<<16,X=X+R|0,d^=X,d=d>>>32-12|d<<12,y=y+M|0,_^=y,_=_>>>32-16|_<<16,g=g+_|0,M^=g,M=M>>>32-12|M<<12,S=S+H|0,U^=S,U=U>>>32-16|U<<16,G=G+U|0,H^=G,H=H>>>32-12|H<<12,v=v+a|0,$^=v,$=$>>>32-16|$<<16,J=J+$|0,a^=J,a=a>>>32-12|a<<12,S=S+H|0,U^=S,U=U>>>32-8|U<<8,G=G+U|0,H^=G,H=H>>>32-7|H<<7,v=v+a|0,$^=v,$=$>>>32-8|$<<8,J=J+$|0,a^=J,a=a>>>32-7|a<<7,y=y+M|0,_^=y,_=_>>>32-8|_<<8,g=g+_|0,M^=g,M=M>>>32-7|M<<7,P=P+d|0,R^=P,R=R>>>32-8|R<<8,X=X+R|0,d^=X,d=d>>>32-7|d<<7;it.writeUint32LE(P+i|0,t,0),it.writeUint32LE(y+n|0,t,4),it.writeUint32LE(S+s|0,t,8),it.writeUint32LE(v+o|0,t,12),it.writeUint32LE(a+c|0,t,16),it.writeUint32LE(d+f|0,t,20),it.writeUint32LE(M+h|0,t,24),it.writeUint32LE(H+l|0,t,28),it.writeUint32LE(G+D|0,t,32),it.writeUint32LE(J+w|0,t,36),it.writeUint32LE(X+m|0,t,40),it.writeUint32LE(g+E|0,t,44),it.writeUint32LE(_+F|0,t,48),it.writeUint32LE(U+N|0,t,52),it.writeUint32LE($+B|0,t,56),it.writeUint32LE(R+x|0,t,60)}function co(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),o=s.length-e.length,s.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,o=n}for(var c=new Uint8Array(64),f=0;f<r.length;f+=64){Gl(c,s,t);for(var h=f;h<f+64&&h<r.length;h++)i[h]=r[h]^c[h-f];kl(s,0,o)}return rn.wipe(c),n===0&&rn.wipe(s),i}ni.streamXOR=co;function Wl(t,e,r,i){return i===void 0&&(i=0),rn.wipe(r),co(t,e,r,r,i)}ni.stream=Wl;function kl(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var uo={},Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});function Yl(t,e,r){return~(t-1)&e|t-1&r}Ft.select=Yl;function Jl(t,e){return(t|0)-(e|0)-1>>>31&1}Ft.lessOrEqual=Jl;function ho(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Ft.compare=ho;function Xl(t,e){return t.length===0||e.length===0?!1:ho(t,e)!==0}Ft.equal=Xl,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ft,r=lt;t.DIGEST_LENGTH=16;var i=function(){function o(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var f=c[0]|c[1]<<8;this._r[0]=f&8191;var h=c[2]|c[3]<<8;this._r[1]=(f>>>13|h<<3)&8191;var l=c[4]|c[5]<<8;this._r[2]=(h>>>10|l<<6)&7939;var D=c[6]|c[7]<<8;this._r[3]=(l>>>7|D<<9)&8191;var w=c[8]|c[9]<<8;this._r[4]=(D>>>4|w<<12)&255,this._r[5]=w>>>1&8190;var m=c[10]|c[11]<<8;this._r[6]=(w>>>14|m<<2)&8191;var E=c[12]|c[13]<<8;this._r[7]=(m>>>11|E<<5)&8065;var F=c[14]|c[15]<<8;this._r[8]=(E>>>8|F<<8)&8191,this._r[9]=F>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return o.prototype._blocks=function(c,f,h){for(var l=this._fin?0:2048,D=this._h[0],w=this._h[1],m=this._h[2],E=this._h[3],F=this._h[4],N=this._h[5],B=this._h[6],x=this._h[7],P=this._h[8],y=this._h[9],S=this._r[0],v=this._r[1],a=this._r[2],d=this._r[3],M=this._r[4],H=this._r[5],G=this._r[6],J=this._r[7],X=this._r[8],g=this._r[9];h>=16;){var _=c[f+0]|c[f+1]<<8;D+=_&8191;var U=c[f+2]|c[f+3]<<8;w+=(_>>>13|U<<3)&8191;var $=c[f+4]|c[f+5]<<8;m+=(U>>>10|$<<6)&8191;var R=c[f+6]|c[f+7]<<8;E+=($>>>7|R<<9)&8191;var C=c[f+8]|c[f+9]<<8;F+=(R>>>4|C<<12)&8191,N+=C>>>1&8191;var j=c[f+10]|c[f+11]<<8;B+=(C>>>14|j<<2)&8191;var z=c[f+12]|c[f+13]<<8;x+=(j>>>11|z<<5)&8191;var Q=c[f+14]|c[f+15]<<8;P+=(z>>>8|Q<<8)&8191,y+=Q>>>5|l;var q=0,ee=q;ee+=D*S,ee+=w*(5*g),ee+=m*(5*X),ee+=E*(5*J),ee+=F*(5*G),q=ee>>>13,ee&=8191,ee+=N*(5*H),ee+=B*(5*M),ee+=x*(5*d),ee+=P*(5*a),ee+=y*(5*v),q+=ee>>>13,ee&=8191;var Y=q;Y+=D*v,Y+=w*S,Y+=m*(5*g),Y+=E*(5*X),Y+=F*(5*J),q=Y>>>13,Y&=8191,Y+=N*(5*G),Y+=B*(5*H),Y+=x*(5*M),Y+=P*(5*d),Y+=y*(5*a),q+=Y>>>13,Y&=8191;var ae=q;ae+=D*a,ae+=w*v,ae+=m*S,ae+=E*(5*g),ae+=F*(5*X),q=ae>>>13,ae&=8191,ae+=N*(5*J),ae+=B*(5*G),ae+=x*(5*H),ae+=P*(5*M),ae+=y*(5*d),q+=ae>>>13,ae&=8191;var T=q;T+=D*d,T+=w*a,T+=m*v,T+=E*S,T+=F*(5*g),q=T>>>13,T&=8191,T+=N*(5*X),T+=B*(5*J),T+=x*(5*G),T+=P*(5*H),T+=y*(5*M),q+=T>>>13,T&=8191;var A=q;A+=D*M,A+=w*d,A+=m*a,A+=E*v,A+=F*S,q=A>>>13,A&=8191,A+=N*(5*g),A+=B*(5*X),A+=x*(5*J),A+=P*(5*G),A+=y*(5*H),q+=A>>>13,A&=8191;var O=q;O+=D*H,O+=w*M,O+=m*d,O+=E*a,O+=F*v,q=O>>>13,O&=8191,O+=N*S,O+=B*(5*g),O+=x*(5*X),O+=P*(5*J),O+=y*(5*G),q+=O>>>13,O&=8191;var u=q;u+=D*G,u+=w*H,u+=m*M,u+=E*d,u+=F*a,q=u>>>13,u&=8191,u+=N*v,u+=B*S,u+=x*(5*g),u+=P*(5*X),u+=y*(5*J),q+=u>>>13,u&=8191;var b=q;b+=D*J,b+=w*G,b+=m*H,b+=E*M,b+=F*d,q=b>>>13,b&=8191,b+=N*a,b+=B*v,b+=x*S,b+=P*(5*g),b+=y*(5*X),q+=b>>>13,b&=8191;var K=q;K+=D*X,K+=w*J,K+=m*G,K+=E*H,K+=F*M,q=K>>>13,K&=8191,K+=N*d,K+=B*a,K+=x*v,K+=P*S,K+=y*(5*g),q+=K>>>13,K&=8191;var W=q;W+=D*g,W+=w*X,W+=m*J,W+=E*G,W+=F*H,q=W>>>13,W&=8191,W+=N*M,W+=B*d,W+=x*a,W+=P*v,W+=y*S,q+=W>>>13,W&=8191,q=(q<<2)+q|0,q=q+ee|0,ee=q&8191,q=q>>>13,Y+=q,D=ee,w=Y,m=ae,E=T,F=A,N=O,B=u,x=b,P=K,y=W,f+=16,h-=16}this._h[0]=D,this._h[1]=w,this._h[2]=m,this._h[3]=E,this._h[4]=F,this._h[5]=N,this._h[6]=B,this._h[7]=x,this._h[8]=P,this._h[9]=y},o.prototype.finish=function(c,f){f===void 0&&(f=0);var h=new Uint16Array(10),l,D,w,m;if(this._leftover){for(m=this._leftover,this._buffer[m++]=1;m<16;m++)this._buffer[m]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,m=2;m<10;m++)this._h[m]+=l,l=this._h[m]>>>13,this._h[m]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,h[0]=this._h[0]+5,l=h[0]>>>13,h[0]&=8191,m=1;m<10;m++)h[m]=this._h[m]+l,l=h[m]>>>13,h[m]&=8191;for(h[9]-=1<<13,D=(l^1)-1,m=0;m<10;m++)h[m]&=D;for(D=~D,m=0;m<10;m++)this._h[m]=this._h[m]&D|h[m];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,w=this._h[0]+this._pad[0],this._h[0]=w&65535,m=1;m<8;m++)w=(this._h[m]+this._pad[m]|0)+(w>>>16)|0,this._h[m]=w&65535;return c[f+0]=this._h[0]>>>0,c[f+1]=this._h[0]>>>8,c[f+2]=this._h[1]>>>0,c[f+3]=this._h[1]>>>8,c[f+4]=this._h[2]>>>0,c[f+5]=this._h[2]>>>8,c[f+6]=this._h[3]>>>0,c[f+7]=this._h[3]>>>8,c[f+8]=this._h[4]>>>0,c[f+9]=this._h[4]>>>8,c[f+10]=this._h[5]>>>0,c[f+11]=this._h[5]>>>8,c[f+12]=this._h[6]>>>0,c[f+13]=this._h[6]>>>8,c[f+14]=this._h[7]>>>0,c[f+15]=this._h[7]>>>8,this._finished=!0,this},o.prototype.update=function(c){var f=0,h=c.length,l;if(this._leftover){l=16-this._leftover,l>h&&(l=h);for(var D=0;D<l;D++)this._buffer[this._leftover+D]=c[f+D];if(h-=l,f+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(h>=16&&(l=h-h%16,this._blocks(c,f,l),f+=l,h-=l),h){for(var D=0;D<h;D++)this._buffer[this._leftover+D]=c[f+D];this._leftover+=h}return this},o.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},o.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},o}();t.Poly1305=i;function n(o,c){var f=new i(o);f.update(c);var h=f.digest();return f.clean(),h}t.oneTimeAuth=n;function s(o,c){return o.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(o,c)}t.equal=s}(uo),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ni,r=uo,i=lt,n=re,s=Ft;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var o=new Uint8Array(16),c=function(){function f(h){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,h.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(h)}return f.prototype.seal=function(h,l,D,w){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var m=new Uint8Array(16);m.set(h,m.length-h.length);var E=new Uint8Array(32);e.stream(this._key,m,E,4);var F=l.length+this.tagLength,N;if(w){if(w.length!==F)throw new Error("ChaCha20Poly1305: incorrect destination length");N=w}else N=new Uint8Array(F);return e.streamXOR(this._key,m,l,N,4),this._authenticate(N.subarray(N.length-this.tagLength,N.length),E,N.subarray(0,N.length-this.tagLength),D),i.wipe(m),N},f.prototype.open=function(h,l,D,w){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var m=new Uint8Array(16);m.set(h,m.length-h.length);var E=new Uint8Array(32);e.stream(this._key,m,E,4);var F=new Uint8Array(this.tagLength);if(this._authenticate(F,E,l.subarray(0,l.length-this.tagLength),D),!s.equal(F,l.subarray(l.length-this.tagLength,l.length)))return null;var N=l.length-this.tagLength,B;if(w){if(w.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");B=w}else B=new Uint8Array(N);return e.streamXOR(this._key,m,l.subarray(0,l.length-this.tagLength),B,4),i.wipe(m),B},f.prototype.clean=function(){return i.wipe(this._key),this},f.prototype._authenticate=function(h,l,D,w){var m=new r.Poly1305(l);w&&(m.update(w),w.length%16>0&&m.update(o.subarray(w.length%16))),m.update(D),D.length%16>0&&m.update(o.subarray(D.length%16));var E=new Uint8Array(8);w&&n.writeUint64LE(w.length,E),m.update(E),n.writeUint64LE(D.length,E),m.update(E);for(var F=m.digest(),N=0;N<F.length;N++)h[N]=F[N];m.clean(),i.wipe(F),i.wipe(E)},f}();t.ChaCha20Poly1305=c}(tn);var fo={},Ar={},nn={};Object.defineProperty(nn,"__esModule",{value:!0});function Zl(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}nn.isSerializableHash=Zl,Object.defineProperty(Ar,"__esModule",{value:!0});var Dt=nn,Ql=Ft,ed=lt,lo=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),Dt.isSerializableHash(this._inner)&&Dt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),ed.wipe(i)}return t.prototype.reset=function(){if(!Dt.isSerializableHash(this._inner)||!Dt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Dt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Dt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Dt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Dt.isSerializableHash(this._inner)||!Dt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Dt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Ar.HMAC=lo;function td(t,e,r){var i=new lo(t,e);i.update(r);var n=i.digest();return i.clean(),n}Ar.hmac=td,Ar.equal=Ql.equal,Object.defineProperty(fo,"__esModule",{value:!0});var po=Ar,go=lt,rd=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=po.hmac(this._hash,i,r);this._hmac=new po.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),go.wipe(this._buffer),go.wipe(this._counter),this._bufpos=0},t}(),id=fo.HKDF=rd,si={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=lt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(f,h){if(h===void 0&&(h=f.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=h,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&h>0;)this._buffer[this._bufferLength++]=f[l++],h--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(h>=this.blockSize&&(l=s(this._temp,this._state,f,l,h),h%=this.blockSize);h>0;)this._buffer[this._bufferLength++]=f[l++],h--;return this},c.prototype.finish=function(f){if(!this._finished){var h=this._bytesHashed,l=this._bufferLength,D=h/536870912|0,w=h<<3,m=h%64<56?64:128;this._buffer[l]=128;for(var E=l+1;E<m-8;E++)this._buffer[E]=0;e.writeUint32BE(D,this._buffer,m-8),e.writeUint32BE(w,this._buffer,m-4),s(this._temp,this._state,this._buffer,0,m),this._finished=!0}for(var E=0;E<this.digestLength/4;E++)e.writeUint32BE(this._state[E],f,E*4);return this},c.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(f){return this._state.set(f.state),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(f){r.wipe(f.state),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,f,h,l,D){for(;D>=64;){for(var w=f[0],m=f[1],E=f[2],F=f[3],N=f[4],B=f[5],x=f[6],P=f[7],y=0;y<16;y++){var S=l+y*4;c[y]=e.readUint32BE(h,S)}for(var y=16;y<64;y++){var v=c[y-2],a=(v>>>17|v<<32-17)^(v>>>19|v<<32-19)^v>>>10;v=c[y-15];var d=(v>>>7|v<<32-7)^(v>>>18|v<<32-18)^v>>>3;c[y]=(a+c[y-7]|0)+(d+c[y-16]|0)}for(var y=0;y<64;y++){var a=(((N>>>6|N<<26)^(N>>>11|N<<21)^(N>>>25|N<<7))+(N&B^~N&x)|0)+(P+(n[y]+c[y]|0)|0)|0,d=((w>>>2|w<<32-2)^(w>>>13|w<<32-13)^(w>>>22|w<<32-22))+(w&m^w&E^m&E)|0;P=x,x=B,B=N,N=F+a|0,F=E,E=m,m=w,w=a+d|0}f[0]+=w,f[1]+=m,f[2]+=E,f[3]+=F,f[4]+=N,f[5]+=B,f[6]+=x,f[7]+=P,l+=64,D-=64}return l}function o(c){var f=new i;f.update(c);var h=f.digest();return f.clean(),h}t.hash=o})(si);var sn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=cr,r=lt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(y){const S=new Float64Array(16);if(y)for(let v=0;v<y.length;v++)S[v]=y[v];return S}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function o(y){let S=1;for(let v=0;v<16;v++){let a=y[v]+S+65535;S=Math.floor(a/65536),y[v]=a-S*65536}y[0]+=S-1+37*(S-1)}function c(y,S,v){const a=~(v-1);for(let d=0;d<16;d++){const M=a&(y[d]^S[d]);y[d]^=M,S[d]^=M}}function f(y,S){const v=i(),a=i();for(let d=0;d<16;d++)a[d]=S[d];o(a),o(a),o(a);for(let d=0;d<2;d++){v[0]=a[0]-65517;for(let H=1;H<15;H++)v[H]=a[H]-65535-(v[H-1]>>16&1),v[H-1]&=65535;v[15]=a[15]-32767-(v[14]>>16&1);const M=v[15]>>16&1;v[14]&=65535,c(a,v,1-M)}for(let d=0;d<16;d++)y[2*d]=a[d]&255,y[2*d+1]=a[d]>>8}function h(y,S){for(let v=0;v<16;v++)y[v]=S[2*v]+(S[2*v+1]<<8);y[15]&=32767}function l(y,S,v){for(let a=0;a<16;a++)y[a]=S[a]+v[a]}function D(y,S,v){for(let a=0;a<16;a++)y[a]=S[a]-v[a]}function w(y,S,v){let a,d,M=0,H=0,G=0,J=0,X=0,g=0,_=0,U=0,$=0,R=0,C=0,j=0,z=0,Q=0,q=0,ee=0,Y=0,ae=0,T=0,A=0,O=0,u=0,b=0,K=0,W=0,fe=0,_e=0,de=0,we=0,Le=0,Te=0,ye=v[0],pe=v[1],le=v[2],ue=v[3],ce=v[4],oe=v[5],se=v[6],te=v[7],he=v[8],ge=v[9],ie=v[10],be=v[11],ve=v[12],Ee=v[13],De=v[14],me=v[15];a=S[0],M+=a*ye,H+=a*pe,G+=a*le,J+=a*ue,X+=a*ce,g+=a*oe,_+=a*se,U+=a*te,$+=a*he,R+=a*ge,C+=a*ie,j+=a*be,z+=a*ve,Q+=a*Ee,q+=a*De,ee+=a*me,a=S[1],H+=a*ye,G+=a*pe,J+=a*le,X+=a*ue,g+=a*ce,_+=a*oe,U+=a*se,$+=a*te,R+=a*he,C+=a*ge,j+=a*ie,z+=a*be,Q+=a*ve,q+=a*Ee,ee+=a*De,Y+=a*me,a=S[2],G+=a*ye,J+=a*pe,X+=a*le,g+=a*ue,_+=a*ce,U+=a*oe,$+=a*se,R+=a*te,C+=a*he,j+=a*ge,z+=a*ie,Q+=a*be,q+=a*ve,ee+=a*Ee,Y+=a*De,ae+=a*me,a=S[3],J+=a*ye,X+=a*pe,g+=a*le,_+=a*ue,U+=a*ce,$+=a*oe,R+=a*se,C+=a*te,j+=a*he,z+=a*ge,Q+=a*ie,q+=a*be,ee+=a*ve,Y+=a*Ee,ae+=a*De,T+=a*me,a=S[4],X+=a*ye,g+=a*pe,_+=a*le,U+=a*ue,$+=a*ce,R+=a*oe,C+=a*se,j+=a*te,z+=a*he,Q+=a*ge,q+=a*ie,ee+=a*be,Y+=a*ve,ae+=a*Ee,T+=a*De,A+=a*me,a=S[5],g+=a*ye,_+=a*pe,U+=a*le,$+=a*ue,R+=a*ce,C+=a*oe,j+=a*se,z+=a*te,Q+=a*he,q+=a*ge,ee+=a*ie,Y+=a*be,ae+=a*ve,T+=a*Ee,A+=a*De,O+=a*me,a=S[6],_+=a*ye,U+=a*pe,$+=a*le,R+=a*ue,C+=a*ce,j+=a*oe,z+=a*se,Q+=a*te,q+=a*he,ee+=a*ge,Y+=a*ie,ae+=a*be,T+=a*ve,A+=a*Ee,O+=a*De,u+=a*me,a=S[7],U+=a*ye,$+=a*pe,R+=a*le,C+=a*ue,j+=a*ce,z+=a*oe,Q+=a*se,q+=a*te,ee+=a*he,Y+=a*ge,ae+=a*ie,T+=a*be,A+=a*ve,O+=a*Ee,u+=a*De,b+=a*me,a=S[8],$+=a*ye,R+=a*pe,C+=a*le,j+=a*ue,z+=a*ce,Q+=a*oe,q+=a*se,ee+=a*te,Y+=a*he,ae+=a*ge,T+=a*ie,A+=a*be,O+=a*ve,u+=a*Ee,b+=a*De,K+=a*me,a=S[9],R+=a*ye,C+=a*pe,j+=a*le,z+=a*ue,Q+=a*ce,q+=a*oe,ee+=a*se,Y+=a*te,ae+=a*he,T+=a*ge,A+=a*ie,O+=a*be,u+=a*ve,b+=a*Ee,K+=a*De,W+=a*me,a=S[10],C+=a*ye,j+=a*pe,z+=a*le,Q+=a*ue,q+=a*ce,ee+=a*oe,Y+=a*se,ae+=a*te,T+=a*he,A+=a*ge,O+=a*ie,u+=a*be,b+=a*ve,K+=a*Ee,W+=a*De,fe+=a*me,a=S[11],j+=a*ye,z+=a*pe,Q+=a*le,q+=a*ue,ee+=a*ce,Y+=a*oe,ae+=a*se,T+=a*te,A+=a*he,O+=a*ge,u+=a*ie,b+=a*be,K+=a*ve,W+=a*Ee,fe+=a*De,_e+=a*me,a=S[12],z+=a*ye,Q+=a*pe,q+=a*le,ee+=a*ue,Y+=a*ce,ae+=a*oe,T+=a*se,A+=a*te,O+=a*he,u+=a*ge,b+=a*ie,K+=a*be,W+=a*ve,fe+=a*Ee,_e+=a*De,de+=a*me,a=S[13],Q+=a*ye,q+=a*pe,ee+=a*le,Y+=a*ue,ae+=a*ce,T+=a*oe,A+=a*se,O+=a*te,u+=a*he,b+=a*ge,K+=a*ie,W+=a*be,fe+=a*ve,_e+=a*Ee,de+=a*De,we+=a*me,a=S[14],q+=a*ye,ee+=a*pe,Y+=a*le,ae+=a*ue,T+=a*ce,A+=a*oe,O+=a*se,u+=a*te,b+=a*he,K+=a*ge,W+=a*ie,fe+=a*be,_e+=a*ve,de+=a*Ee,we+=a*De,Le+=a*me,a=S[15],ee+=a*ye,Y+=a*pe,ae+=a*le,T+=a*ue,A+=a*ce,O+=a*oe,u+=a*se,b+=a*te,K+=a*he,W+=a*ge,fe+=a*ie,_e+=a*be,de+=a*ve,we+=a*Ee,Le+=a*De,Te+=a*me,M+=38*Y,H+=38*ae,G+=38*T,J+=38*A,X+=38*O,g+=38*u,_+=38*b,U+=38*K,$+=38*W,R+=38*fe,C+=38*_e,j+=38*de,z+=38*we,Q+=38*Le,q+=38*Te,d=1,a=M+d+65535,d=Math.floor(a/65536),M=a-d*65536,a=H+d+65535,d=Math.floor(a/65536),H=a-d*65536,a=G+d+65535,d=Math.floor(a/65536),G=a-d*65536,a=J+d+65535,d=Math.floor(a/65536),J=a-d*65536,a=X+d+65535,d=Math.floor(a/65536),X=a-d*65536,a=g+d+65535,d=Math.floor(a/65536),g=a-d*65536,a=_+d+65535,d=Math.floor(a/65536),_=a-d*65536,a=U+d+65535,d=Math.floor(a/65536),U=a-d*65536,a=$+d+65535,d=Math.floor(a/65536),$=a-d*65536,a=R+d+65535,d=Math.floor(a/65536),R=a-d*65536,a=C+d+65535,d=Math.floor(a/65536),C=a-d*65536,a=j+d+65535,d=Math.floor(a/65536),j=a-d*65536,a=z+d+65535,d=Math.floor(a/65536),z=a-d*65536,a=Q+d+65535,d=Math.floor(a/65536),Q=a-d*65536,a=q+d+65535,d=Math.floor(a/65536),q=a-d*65536,a=ee+d+65535,d=Math.floor(a/65536),ee=a-d*65536,M+=d-1+37*(d-1),d=1,a=M+d+65535,d=Math.floor(a/65536),M=a-d*65536,a=H+d+65535,d=Math.floor(a/65536),H=a-d*65536,a=G+d+65535,d=Math.floor(a/65536),G=a-d*65536,a=J+d+65535,d=Math.floor(a/65536),J=a-d*65536,a=X+d+65535,d=Math.floor(a/65536),X=a-d*65536,a=g+d+65535,d=Math.floor(a/65536),g=a-d*65536,a=_+d+65535,d=Math.floor(a/65536),_=a-d*65536,a=U+d+65535,d=Math.floor(a/65536),U=a-d*65536,a=$+d+65535,d=Math.floor(a/65536),$=a-d*65536,a=R+d+65535,d=Math.floor(a/65536),R=a-d*65536,a=C+d+65535,d=Math.floor(a/65536),C=a-d*65536,a=j+d+65535,d=Math.floor(a/65536),j=a-d*65536,a=z+d+65535,d=Math.floor(a/65536),z=a-d*65536,a=Q+d+65535,d=Math.floor(a/65536),Q=a-d*65536,a=q+d+65535,d=Math.floor(a/65536),q=a-d*65536,a=ee+d+65535,d=Math.floor(a/65536),ee=a-d*65536,M+=d-1+37*(d-1),y[0]=M,y[1]=H,y[2]=G,y[3]=J,y[4]=X,y[5]=g,y[6]=_,y[7]=U,y[8]=$,y[9]=R,y[10]=C,y[11]=j,y[12]=z,y[13]=Q,y[14]=q,y[15]=ee}function m(y,S){w(y,S,S)}function E(y,S){const v=i();for(let a=0;a<16;a++)v[a]=S[a];for(let a=253;a>=0;a--)m(v,v),a!==2&&a!==4&&w(v,v,S);for(let a=0;a<16;a++)y[a]=v[a]}function F(y,S){const v=new Uint8Array(32),a=new Float64Array(80),d=i(),M=i(),H=i(),G=i(),J=i(),X=i();for(let $=0;$<31;$++)v[$]=y[$];v[31]=y[31]&127|64,v[0]&=248,h(a,S);for(let $=0;$<16;$++)M[$]=a[$];d[0]=G[0]=1;for(let $=254;$>=0;--$){const R=v[$>>>3]>>>($&7)&1;c(d,M,R),c(H,G,R),l(J,d,H),D(d,d,H),l(H,M,G),D(M,M,G),m(G,J),m(X,d),w(d,H,d),w(H,M,J),l(J,d,H),D(d,d,H),m(M,d),D(H,G,X),w(d,H,s),l(d,d,G),w(H,H,d),w(d,G,X),w(G,M,a),m(M,J),c(d,M,R),c(H,G,R)}for(let $=0;$<16;$++)a[$+16]=d[$],a[$+32]=H[$],a[$+48]=M[$],a[$+64]=G[$];const g=a.subarray(32),_=a.subarray(16);E(g,g),w(_,_,g);const U=new Uint8Array(32);return f(U,_),U}t.scalarMult=F;function N(y){return F(y,n)}t.scalarMultBase=N;function B(y){if(y.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const S=new Uint8Array(y);return{publicKey:N(S),secretKey:S}}t.generateKeyPairFromSeed=B;function x(y){const S=(0,e.randomBytes)(32,y),v=B(S);return(0,r.wipe)(S),v}t.generateKeyPair=x;function P(y,S,v=!1){if(y.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(S.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const a=F(y,S);if(v){let d=0;for(let M=0;M<a.length;M++)d|=a[M];if(d===0)throw new Error("X25519: invalid shared key")}return a}t.sharedKey=P})(sn);var yo=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},nd=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),sd=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),od=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),ad=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),cd=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),ud=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,hd=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,_o=3,fd=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ud]],bo=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ld(t){return t?vo(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new cd:typeof navigator<"u"?vo(navigator.userAgent):gd()}function dd(t){return t!==""&&fd.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function vo(t){var e=dd(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new ad;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<_o&&(n=yo(yo([],n,!0),yd(_o-n.length),!0)):n=[];var s=n.join("."),o=pd(t),c=hd.exec(t);return c&&c[1]?new od(r,s,o,c[1]):new nd(r,s,o)}function pd(t){for(var e=0,r=bo.length;e<r;e++){var i=bo[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function gd(){var t=typeof process<"u"&&process.version;return t?new sd(process.version.slice(1)):null}function yd(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=mo=Oe.getLocation=Oe.getLocationOrThrow=on=Oe.getNavigator=Oe.getNavigatorOrThrow=wo=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Jt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Oe.getFromWindow=Jt;function ur(t){const e=Jt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Oe.getFromWindowOrThrow=ur;function _d(){return ur("document")}Oe.getDocumentOrThrow=_d;function bd(){return Jt("document")}var wo=Oe.getDocument=bd;function vd(){return ur("navigator")}Oe.getNavigatorOrThrow=vd;function wd(){return Jt("navigator")}var on=Oe.getNavigator=wd;function md(){return ur("location")}Oe.getLocationOrThrow=md;function Ed(){return Jt("location")}var mo=Oe.getLocation=Ed;function Dd(){return ur("crypto")}Oe.getCryptoOrThrow=Dd;function Sd(){return Jt("crypto")}Oe.getCrypto=Sd;function xd(){return ur("localStorage")}Oe.getLocalStorageOrThrow=xd;function Od(){return Jt("localStorage")}Oe.getLocalStorage=Od;var an={};Object.defineProperty(an,"__esModule",{value:!0});var Eo=an.getWindowMetadata=void 0;const Do=Oe;function Id(){let t,e;try{t=Do.getDocumentOrThrow(),e=Do.getLocationOrThrow()}catch{return null}function r(){const D=t.getElementsByTagName("link"),w=[];for(let m=0;m<D.length;m++){const E=D[m],F=E.getAttribute("rel");if(F&&F.toLowerCase().indexOf("icon")>-1){const N=E.getAttribute("href");if(N)if(N.toLowerCase().indexOf("https:")===-1&&N.toLowerCase().indexOf("http:")===-1&&N.indexOf("//")!==0){let B=e.protocol+"//"+e.host;if(N.indexOf("/")===0)B+=N;else{const x=e.pathname.split("/");x.pop();const P=x.join("/");B+=P+"/"+N}w.push(B)}else if(N.indexOf("//")===0){const B=e.protocol+N;w.push(B)}else w.push(N)}}return w}function i(...D){const w=t.getElementsByTagName("meta");for(let m=0;m<w.length;m++){const E=w[m],F=["itemprop","property","name"].map(N=>E.getAttribute(N)).filter(N=>N?D.includes(N):!1);if(F.length&&F){const N=E.getAttribute("content");if(N)return N}}return""}function n(){let D=i("name","og:site_name","og:title","twitter:title");return D||(D=t.title),D}function s(){return i("description","og:description","twitter:description","keywords")}const o=n(),c=s(),f=e.origin,h=r();return{description:c,url:f,icons:h,name:o}}Eo=an.getWindowMetadata=Id;var Tr={},Pd=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),So="%[a-f0-9]{2}",xo=new RegExp("("+So+")|([^%]+?)","gi"),Oo=new RegExp("("+So+")+","gi");function cn(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],cn(r),cn(i))}function Ad(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(xo)||[],r=1;r<e.length;r++)t=cn(e,r).join(""),e=t.match(xo)||[];return t}}function Td(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=Oo.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=Ad(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Oo.exec(t)}e["%C2"]="\uFFFD";for(var n=Object.keys(e),s=0;s<n.length;s++){var o=n[s];t=t.replace(new RegExp(o,"g"),e[o])}return t}var Cd=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Td(t)}},Rd=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},Nd=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var o=i[s],c=t[o];(n?e.indexOf(o)!==-1:e(o,c,t))&&(r[o]=c)}return r};(function(t){const e=Pd,r=Cd,i=Rd,n=Nd,s=x=>x==null,o=Symbol("encodeFragmentIdentifier");function c(x){switch(x.arrayFormat){case"index":return P=>(y,S)=>{const v=y.length;return S===void 0||x.skipNull&&S===null||x.skipEmptyString&&S===""?y:S===null?[...y,[l(P,x),"[",v,"]"].join("")]:[...y,[l(P,x),"[",l(v,x),"]=",l(S,x)].join("")]};case"bracket":return P=>(y,S)=>S===void 0||x.skipNull&&S===null||x.skipEmptyString&&S===""?y:S===null?[...y,[l(P,x),"[]"].join("")]:[...y,[l(P,x),"[]=",l(S,x)].join("")];case"colon-list-separator":return P=>(y,S)=>S===void 0||x.skipNull&&S===null||x.skipEmptyString&&S===""?y:S===null?[...y,[l(P,x),":list="].join("")]:[...y,[l(P,x),":list=",l(S,x)].join("")];case"comma":case"separator":case"bracket-separator":{const P=x.arrayFormat==="bracket-separator"?"[]=":"=";return y=>(S,v)=>v===void 0||x.skipNull&&v===null||x.skipEmptyString&&v===""?S:(v=v===null?"":v,S.length===0?[[l(y,x),P,l(v,x)].join("")]:[[S,l(v,x)].join(x.arrayFormatSeparator)])}default:return P=>(y,S)=>S===void 0||x.skipNull&&S===null||x.skipEmptyString&&S===""?y:S===null?[...y,l(P,x)]:[...y,[l(P,x),"=",l(S,x)].join("")]}}function f(x){let P;switch(x.arrayFormat){case"index":return(y,S,v)=>{if(P=/\[(\d*)\]$/.exec(y),y=y.replace(/\[\d*\]$/,""),!P){v[y]=S;return}v[y]===void 0&&(v[y]={}),v[y][P[1]]=S};case"bracket":return(y,S,v)=>{if(P=/(\[\])$/.exec(y),y=y.replace(/\[\]$/,""),!P){v[y]=S;return}if(v[y]===void 0){v[y]=[S];return}v[y]=[].concat(v[y],S)};case"colon-list-separator":return(y,S,v)=>{if(P=/(:list)$/.exec(y),y=y.replace(/:list$/,""),!P){v[y]=S;return}if(v[y]===void 0){v[y]=[S];return}v[y]=[].concat(v[y],S)};case"comma":case"separator":return(y,S,v)=>{const a=typeof S=="string"&&S.includes(x.arrayFormatSeparator),d=typeof S=="string"&&!a&&D(S,x).includes(x.arrayFormatSeparator);S=d?D(S,x):S;const M=a||d?S.split(x.arrayFormatSeparator).map(H=>D(H,x)):S===null?S:D(S,x);v[y]=M};case"bracket-separator":return(y,S,v)=>{const a=/(\[\])$/.test(y);if(y=y.replace(/\[\]$/,""),!a){v[y]=S&&D(S,x);return}const d=S===null?[]:S.split(x.arrayFormatSeparator).map(M=>D(M,x));if(v[y]===void 0){v[y]=d;return}v[y]=[].concat(v[y],d)};default:return(y,S,v)=>{if(v[y]===void 0){v[y]=S;return}v[y]=[].concat(v[y],S)}}}function h(x){if(typeof x!="string"||x.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(x,P){return P.encode?P.strict?e(x):encodeURIComponent(x):x}function D(x,P){return P.decode?r(x):x}function w(x){return Array.isArray(x)?x.sort():typeof x=="object"?w(Object.keys(x)).sort((P,y)=>Number(P)-Number(y)).map(P=>x[P]):x}function m(x){const P=x.indexOf("#");return P!==-1&&(x=x.slice(0,P)),x}function E(x){let P="";const y=x.indexOf("#");return y!==-1&&(P=x.slice(y)),P}function F(x){x=m(x);const P=x.indexOf("?");return P===-1?"":x.slice(P+1)}function N(x,P){return P.parseNumbers&&!Number.isNaN(Number(x))&&typeof x=="string"&&x.trim()!==""?x=Number(x):P.parseBooleans&&x!==null&&(x.toLowerCase()==="true"||x.toLowerCase()==="false")&&(x=x.toLowerCase()==="true"),x}function B(x,P){P=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},P),h(P.arrayFormatSeparator);const y=f(P),S=Object.create(null);if(typeof x!="string"||(x=x.trim().replace(/^[?#&]/,""),!x))return S;for(const v of x.split("&")){if(v==="")continue;let[a,d]=i(P.decode?v.replace(/\+/g," "):v,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(P.arrayFormat)?d:D(d,P),y(D(a,P),d,S)}for(const v of Object.keys(S)){const a=S[v];if(typeof a=="object"&&a!==null)for(const d of Object.keys(a))a[d]=N(a[d],P);else S[v]=N(a,P)}return P.sort===!1?S:(P.sort===!0?Object.keys(S).sort():Object.keys(S).sort(P.sort)).reduce((v,a)=>{const d=S[a];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?v[a]=w(d):v[a]=d,v},Object.create(null))}t.extract=F,t.parse=B,t.stringify=(x,P)=>{if(!x)return"";P=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},P),h(P.arrayFormatSeparator);const y=d=>P.skipNull&&s(x[d])||P.skipEmptyString&&x[d]==="",S=c(P),v={};for(const d of Object.keys(x))y(d)||(v[d]=x[d]);const a=Object.keys(v);return P.sort!==!1&&a.sort(P.sort),a.map(d=>{const M=x[d];return M===void 0?"":M===null?l(d,P):Array.isArray(M)?M.length===0&&P.arrayFormat==="bracket-separator"?l(d,P)+"[]":M.reduce(S(d),[]).join("&"):l(d,P)+"="+l(M,P)}).filter(d=>d.length>0).join("&")},t.parseUrl=(x,P)=>{P=Object.assign({decode:!0},P);const[y,S]=i(x,"#");return Object.assign({url:y.split("?")[0]||"",query:B(F(x),P)},P&&P.parseFragmentIdentifier&&S?{fragmentIdentifier:D(S,P)}:{})},t.stringifyUrl=(x,P)=>{P=Object.assign({encode:!0,strict:!0,[o]:!0},P);const y=m(x.url).split("?")[0]||"",S=t.extract(x.url),v=t.parse(S,{sort:!1}),a=Object.assign(v,x.query);let d=t.stringify(a,P);d&&(d=`?${d}`);let M=E(x.url);return x.fragmentIdentifier&&(M=`#${P[o]?l(x.fragmentIdentifier,P):x.fragmentIdentifier}`),`${y}${d}${M}`},t.pick=(x,P,y)=>{y=Object.assign({parseFragmentIdentifier:!0,[o]:!1},y);const{url:S,query:v,fragmentIdentifier:a}=t.parseUrl(x,y);return t.stringifyUrl({url:S,query:n(v,P),fragmentIdentifier:a},y)},t.exclude=(x,P,y)=>{const S=Array.isArray(P)?v=>!P.includes(v):(v,a)=>!P(v,a);return t.pick(x,S,y)}})(Tr);const Fd={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},Io="base10",ht="base16",un="base64pad",hn="utf8",Po=0,Xt=1,Ld=0,Ao=1,fn=12,ln=32;function Ud(){const t=sn.generateKeyPair();return{privateKey:ct(t.secretKey,ht),publicKey:ct(t.publicKey,ht)}}function dn(){const t=cr.randomBytes(ln);return ct(t,ht)}function $d(t,e){const r=sn.sharedKey(ut(t,ht),ut(e,ht)),i=new id(si.SHA256,r).expand(ln);return ct(i,ht)}function Md(t){const e=si.hash(ut(t,ht));return ct(e,ht)}function pn(t){const e=si.hash(ut(t,hn));return ct(e,ht)}function jd(t){return ut(`${t}`,Io)}function Cr(t){return Number(ct(t,Io))}function Bd(t){const e=jd(typeof t.type<"u"?t.type:Po);if(Cr(e)===Xt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ut(t.senderPublicKey,ht):void 0,i=typeof t.iv<"u"?ut(t.iv,ht):cr.randomBytes(fn),n=new tn.ChaCha20Poly1305(ut(t.symKey,ht)).seal(i,ut(t.message,hn));return Hd({type:e,sealed:n,iv:i,senderPublicKey:r})}function zd(t){const e=new tn.ChaCha20Poly1305(ut(t.symKey,ht)),{sealed:r,iv:i}=gn(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return ct(n,hn)}function Hd(t){if(Cr(t.type)===Xt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ct(Xi([t.type,t.senderPublicKey,t.iv,t.sealed]),un)}return ct(Xi([t.type,t.iv,t.sealed]),un)}function gn(t){const e=ut(t,un),r=e.slice(Ld,Ao),i=Ao;if(Cr(r)===Xt){const c=i+ln,f=c+fn,h=e.slice(i,c),l=e.slice(c,f),D=e.slice(f);return{type:r,sealed:D,iv:l,senderPublicKey:h}}const n=i+fn,s=e.slice(i,n),o=e.slice(n);return{type:r,sealed:o,iv:s}}function qd(t,e){const r=gn(t);return To({type:Cr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ct(r.senderPublicKey,ht):void 0,receiverPublicKey:e?.receiverPublicKey})}function To(t){const e=t?.type||Po;if(e===Xt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Co(t){return t.type===Xt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Kd=Object.defineProperty,Ro=Object.getOwnPropertySymbols,Vd=Object.prototype.hasOwnProperty,Gd=Object.prototype.propertyIsEnumerable,No=(t,e,r)=>e in t?Kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fo=(t,e)=>{for(var r in e||(e={}))Vd.call(e,r)&&No(t,r,e[r]);if(Ro)for(var r of Ro(e))Gd.call(e,r)&&No(t,r,e[r]);return t};const Wd="ReactNative",Rr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},kd="js";function Lo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Yd(){return!wo()&&!!on()&&navigator.product===Wd}function Jd(){return!Lo()&&!!on()}function Xd(){return Yd()?Rr.reactNative:Lo()?Rr.node:Jd()?Rr.browser:Rr.unknown}function Zd(t,e){let r=Tr.parse(t);return r=Fo(Fo({},r),e),t=Tr.stringify(r),t}function Qd(){return Eo()||{name:"",description:"",url:"",icons:[""]}}function ep(){const t=ld();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function tp(){var t;const e=Xd();return e===Rr.browser?[e,((t=mo())==null?void 0:t.host)||"unknown"].join(":"):e}function rp(t,e,r){const i=ep(),n=tp();return[[t,e].join("-"),[kd,r].join("-"),i,n].join("/")}function ip({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s}){const o=r.split("?"),c=rp(t,e,i),f={auth:n,ua:c,projectId:s},h=Zd(o[1]||"",f);return o[0]+"?"+h}function Lt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Uo(t){return Object.fromEntries(t.entries())}function $o(t){return new Map(Object.entries(t))}function St(t,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(t))}function Ut(t){return Z.fromMiliseconds(Date.now())>=Z.toMiliseconds(t)}function Zt(t){const e=Z.toMiliseconds(t||Z.FIVE_MINUTES);let r,i,n;return{resolve:s=>{n&&r&&(clearTimeout(n),r(s))},reject:s=>{n&&i&&(clearTimeout(n),i(s))},done:()=>new Promise((s,o)=>{n=setTimeout(o,e),r=s,i=o})}}function Mo(t,e){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(),e),s=await t;clearTimeout(n),r(s)})}function jo(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function np(t){return jo("topic",t)}function sp(t){return jo("id",t)}function Bo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Fe(t,e){return`${t}${e?`:${e}`:""}`}const op="irn";function yn(t){return t?.relay||{protocol:op}}function _n(t){const e=Fd[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var ap=Object.defineProperty,zo=Object.getOwnPropertySymbols,cp=Object.prototype.hasOwnProperty,up=Object.prototype.propertyIsEnumerable,Ho=(t,e,r)=>e in t?ap(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hp=(t,e)=>{for(var r in e||(e={}))cp.call(e,r)&&Ho(t,r,e[r]);if(zo)for(var r of zo(e))up.call(e,r)&&Ho(t,r,e[r]);return t};function fp(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function lp(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=Tr.parse(s);return{protocol:i,topic:n[0],version:parseInt(n[1],10),symKey:o.symKey,relay:fp(o)}}function dp(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function pp(t){return`${t.protocol}:${t.topic}@${t.version}?`+Tr.stringify(hp({symKey:t.symKey},dp(t.relay)))}function Nr(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function gp(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Nr(r.accounts))}),e}function yp(t,e){const r=[];return Object.values(t).forEach(i=>{Nr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function _p(t,e){const r=[];return Object.values(t).forEach(i=>{Nr(i.accounts).includes(e)&&r.push(...i.events)}),r}function bp(t,e){const r=ai(t,e);if(r)throw new Error(r.message);const i={};for(const[n,s]of Object.entries(t))i[n]={methods:s.methods,events:s.events,chains:s.accounts.map(o=>`${o.split(":")[0]}:${o.split(":")[1]}`)};return i}const vp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},wp={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=wp[t];return{message:e?`${r} ${e}`:r,code:i}}function ze(t,e){const{message:r,code:i}=vp[t];return{message:e?`${r} ${e}`:r,code:i}}function Fr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function oi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function gt(t){return typeof t>"u"}function Qe(t,e){return e&&gt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function bn(t,e){return e&&gt(t)?!0:typeof t=="number"&&!isNaN(t)}function mp(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Lt(n,i)?(i.forEach(o=>{const{accounts:c,methods:f,events:h}=t.namespaces[o],l=Nr(c),D=r[o];(!Lt(D.chains,l)||!Lt(D.methods,f)||!Lt(D.events,h))&&(s=!1)}),s):!1}function vn(t){return Qe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Ep(t){if(Qe(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&vn(r)}}return!1}function Dp(t){if(Qe(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Sp(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function xp(t){return t?.topic}function Op(t,e){let r=null;return Qe(t?.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function qo(t){let e=!0;return Fr(t)?t.length&&(e=t.every(r=>Qe(r,!1))):e=!1,e}function Ip(t,e,r){let i=null;return Fr(e)?e.forEach(n=>{i||(!vn(n)||!n.includes(t))&&(i=ze("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):i=ze("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Pp(t,e){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const s=Ip(i,n?.chains,`${e} requiredNamespace`);s&&(r=s)}),r}function Ap(t,e){let r=null;return Fr(t)?t.forEach(i=>{r||Ep(i)||(r=ze("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ze("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Tp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Ap(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function Cp(t,e){let r=null;return qo(t?.methods)?qo(t?.events)||(r=ze("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ze("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ko(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Cp(i,`${e}, namespace`);n&&(r=n)}),r}function Rp(t,e){let r=null;if(t&&oi(t)){const i=Ko(t,e);i&&(r=i);const n=Pp(t,e);n&&(r=n)}else r=V("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function ai(t,e){let r=null;if(t&&oi(t)){const i=Ko(t,e);i&&(r=i);const n=Tp(t,e);n&&(r=n)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Vo(t){return Qe(t.protocol,!0)}function Np(t,e){let r=!1;return e&&!t?r=!0:t&&Fr(t)&&t.length&&t.forEach(i=>{r=Vo(i)}),r}function Fp(t){return typeof t=="number"}function ft(t){return typeof t<"u"&&typeof t!==null}function Lp(t){return!(!t||typeof t!="object"||!t.code||!bn(t.code,!1)||!t.message||!Qe(t.message,!1))}function Up(t){return!(gt(t)||!Qe(t.method,!1))}function $p(t){return!(gt(t)||gt(t.result)&&gt(t.error)||!bn(t.id,!1)||!Qe(t.jsonrpc,!1))}function Mp(t){return!(gt(t)||!Qe(t.name,!1))}function Go(t,e){return!(!vn(e)||!gp(t).includes(e))}function jp(t,e,r){return Qe(r,!1)?yp(t,e).includes(r):!1}function Bp(t,e,r){return Qe(r,!1)?_p(t,e).includes(r):!1}function Wo(t,e,r){let i=null;const n=Object.keys(t),s=Object.keys(e);return Lt(n,s)?n.forEach(o=>{if(i)return;const c=t[o].chains,f=Nr(e[o].accounts);Lt(c,f)?Lt(t[o].methods,e[o].methods)?Lt(t[o].events,e[o].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${o}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${o}`):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${o}`)}):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}function zp(t,e){return bn(t,!1)&&t<=e.max&&t>=e.min}const Hp="PARSE_ERROR",qp="INVALID_REQUEST",Kp="METHOD_NOT_FOUND",Vp="INVALID_PARAMS",ko="INTERNAL_ERROR",wn="SERVER_ERROR",Gp=[-32700,-32600,-32601,-32602,-32603],Lr={[Hp]:{code:-32700,message:"Parse error"},[qp]:{code:-32600,message:"Invalid Request"},[Kp]:{code:-32601,message:"Method not found"},[Vp]:{code:-32602,message:"Invalid params"},[ko]:{code:-32603,message:"Internal error"},[wn]:{code:-32e3,message:"Server error"}},Yo=wn;function Wp(t){return Gp.includes(t)}function Jo(t){return Object.keys(Lr).includes(t)?Lr[t]:Lr[Yo]}function kp(t){const e=Object.values(Lr).find(r=>r.code===t);return e||Lr[Yo]}function Xo(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Zo={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var mn=function(t,e){return mn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},mn(t,e)};function Yp(t,e){mn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var En=function(){return En=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},En.apply(this,arguments)};function Jp(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Xp(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Zp(t,e){return function(r,i){e(r,i,t)}}function Qp(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function eg(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function c(l){try{h(i.next(l))}catch(D){o(D)}}function f(l){try{h(i.throw(l))}catch(D){o(D)}}function h(l){l.done?s(l.value):n(l.value).then(c,f)}h((i=i.apply(t,e||[])).next())})}function tg(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(h){return function(l){return f([h,l])}}function f(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,n=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(l){h=[6,l],n=0}finally{i=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function rg(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ig(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Dn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qo(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function ng(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Qo(arguments[e]));return t}function sg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,c=s.length;o<c;o++,n++)i[n]=s[o];return i}function Ur(t){return this instanceof Ur?(this.v=t,this):new Ur(t)}function og(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(w){i[w]&&(n[w]=function(m){return new Promise(function(E,F){s.push([w,m,E,F])>1||c(w,m)})})}function c(w,m){try{f(i[w](m))}catch(E){D(s[0][3],E)}}function f(w){w.value instanceof Ur?Promise.resolve(w.value.v).then(h,l):D(s[0][2],w)}function h(w){c("next",w)}function l(w){c("throw",w)}function D(w,m){w(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ag(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Ur(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function cg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Dn=="function"?Dn(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(c,f){o=t[s](o),n(c,f,o.done,o.value)})}}function n(s,o,c,f){Promise.resolve(f).then(function(h){s({value:h,done:c})},o)}}function ug(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function hg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function fg(t){return t&&t.__esModule?t:{default:t}}function lg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function dg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var pg=Object.freeze({__proto__:null,__extends:Yp,get __assign(){return En},__rest:Jp,__decorate:Xp,__param:Zp,__metadata:Qp,__awaiter:eg,__generator:tg,__createBinding:rg,__exportStar:ig,__values:Dn,__read:Qo,__spread:ng,__spreadArrays:sg,__await:Ur,__asyncGenerator:og,__asyncDelegator:ag,__asyncValues:cg,__makeTemplateObject:ug,__importStar:hg,__importDefault:fg,__classPrivateFieldGet:lg,__classPrivateFieldSet:dg}),gg=Kt(pg),Pt={},ea;function yg(){if(ea)return Pt;ea=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.isBrowserCryptoAvailable=Pt.getSubtleCrypto=Pt.getBrowerCrypto=void 0;function t(){return qe?.crypto||qe?.msCrypto||{}}Pt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Pt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Pt.isBrowserCryptoAvailable=r,Pt}var At={},ta;function _g(){if(ta)return At;ta=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowser=At.isNode=At.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}At.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}At.isNode=e;function r(){return!t()&&!e()}return At.isBrowser=r,At}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=gg;e.__exportStar(yg(),t),e.__exportStar(_g(),t)})(Zo);function bg(){const t=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return t+e}function ci(t,e,r){return{id:r||bg(),jsonrpc:"2.0",method:t,params:e}}function Sn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ui(t,e,r){return{id:t,jsonrpc:"2.0",error:vg(e,r)}}function vg(t,e){return typeof t>"u"?Jo(ko):(typeof t=="string"&&(t=Object.assign(Object.assign({},Jo(wn)),{message:t})),typeof e<"u"&&(t.data=e),Wp(t.code)&&(t=kp(t.code)),t)}class wg{}class mg extends wg{constructor(){super()}}class Eg extends mg{constructor(e){super()}}const Dg="^https?:",Sg="^wss?:";function xg(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ra(t,e){const r=xg(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function ia(t){return ra(t,Dg)}function na(t){return ra(t,Sg)}function Og(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function sa(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function xn(t){return sa(t)&&"method"in t}function On(t){return sa(t)&&(Tt(t)||vt(t))}function Tt(t){return"result"in t}function vt(t){return"error"in t}class $r extends Eg{constructor(e){super(e),this.events=new rt.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(ci(e.method,e.params||[]),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{vt(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),On(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.hasRegisteredEventListeners=!0)}}const oa=10,Ig=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Pg=()=>typeof window<"u",Ag=Ig();class Tg{constructor(e){if(this.url=e,this.events=new rt.exports.EventEmitter,this.registering=!1,!na(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ir(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!na(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Zo.isReactNative()?void 0:{rejectUnauthorized:!Og(e)},s=new Ag(e,[],n);Pg()?s.onerror=o=>{const c=o;i(this.emitError(c.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Vi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=ui(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Xo(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>oa&&this.events.setMaxListeners(oa)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var In={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,o=9007199254740991,c="[object Arguments]",f="[object Array]",h="[object AsyncFunction]",l="[object Boolean]",D="[object Date]",w="[object Error]",m="[object Function]",E="[object GeneratorFunction]",F="[object Map]",N="[object Number]",B="[object Null]",x="[object Object]",P="[object Promise]",y="[object Proxy]",S="[object RegExp]",v="[object Set]",a="[object String]",d="[object Symbol]",M="[object Undefined]",H="[object WeakMap]",G="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",g="[object Float64Array]",_="[object Int8Array]",U="[object Int16Array]",$="[object Int32Array]",R="[object Uint8Array]",C="[object Uint8ClampedArray]",j="[object Uint16Array]",z="[object Uint32Array]",Q=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,ee=/^(?:0|[1-9]\d*)$/,Y={};Y[X]=Y[g]=Y[_]=Y[U]=Y[$]=Y[R]=Y[C]=Y[j]=Y[z]=!0,Y[c]=Y[f]=Y[G]=Y[l]=Y[J]=Y[D]=Y[w]=Y[m]=Y[F]=Y[N]=Y[x]=Y[S]=Y[v]=Y[a]=Y[H]=!1;var ae=typeof qe=="object"&&qe&&qe.Object===Object&&qe,T=typeof self=="object"&&self&&self.Object===Object&&self,A=ae||T||Function("return this")(),O=e&&!e.nodeType&&e,u=O&&!0&&t&&!t.nodeType&&t,b=u&&u.exports===O,K=b&&ae.process,W=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),fe=W&&W.isTypedArray;function _e(p,I){for(var L=-1,k=p==null?0:p.length,Ie=0,ne=[];++L<k;){var Ne=p[L];I(Ne,L,p)&&(ne[Ie++]=Ne)}return ne}function de(p,I){for(var L=-1,k=I.length,Ie=p.length;++L<k;)p[Ie+L]=I[L];return p}function we(p,I){for(var L=-1,k=p==null?0:p.length;++L<k;)if(I(p[L],L,p))return!0;return!1}function Le(p,I){for(var L=-1,k=Array(p);++L<p;)k[L]=I(L);return k}function Te(p){return function(I){return p(I)}}function ye(p,I){return p.has(I)}function pe(p,I){return p?.[I]}function le(p){var I=-1,L=Array(p.size);return p.forEach(function(k,Ie){L[++I]=[Ie,k]}),L}function ue(p,I){return function(L){return p(I(L))}}function ce(p){var I=-1,L=Array(p.size);return p.forEach(function(k){L[++I]=k}),L}var oe=Array.prototype,se=Function.prototype,te=Object.prototype,he=A["__core-js_shared__"],ge=se.toString,ie=te.hasOwnProperty,be=function(){var p=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),ve=te.toString,Ee=RegExp("^"+ge.call(ie).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=b?A.Buffer:void 0,me=A.Symbol,wt=A.Uint8Array,It=te.propertyIsEnumerable,jt=oe.splice,dt=me?me.toStringTag:void 0,Qt=Object.getOwnPropertySymbols,zr=De?De.isBuffer:void 0,_i=ue(Object.keys,Object),Ue=hr(A,"DataView"),Ce=hr(A,"Map"),$e=hr(A,"Promise"),Me=hr(A,"Set"),je=hr(A,"WeakMap"),Re=hr(Object,"create"),Ke=tr(Ue),Ve=tr(Ce),Ge=tr($e),We=tr(Me),ke=tr(je),He=me?me.prototype:void 0,Be=He?He.valueOf:void 0;function Pe(p){var I=-1,L=p==null?0:p.length;for(this.clear();++I<L;){var k=p[I];this.set(k[0],k[1])}}function Ye(){this.__data__=Re?Re(null):{},this.size=0}function Je(p){var I=this.has(p)&&delete this.__data__[p];return this.size-=I?1:0,I}function T_(p){var I=this.__data__;if(Re){var L=I[p];return L===i?void 0:L}return ie.call(I,p)?I[p]:void 0}function C_(p){var I=this.__data__;return Re?I[p]!==void 0:ie.call(I,p)}function R_(p,I){var L=this.__data__;return this.size+=this.has(p)?0:1,L[p]=Re&&I===void 0?i:I,this}Pe.prototype.clear=Ye,Pe.prototype.delete=Je,Pe.prototype.get=T_,Pe.prototype.has=C_,Pe.prototype.set=R_;function Rt(p){var I=-1,L=p==null?0:p.length;for(this.clear();++I<L;){var k=p[I];this.set(k[0],k[1])}}function N_(){this.__data__=[],this.size=0}function F_(p){var I=this.__data__,L=vi(I,p);if(L<0)return!1;var k=I.length-1;return L==k?I.pop():jt.call(I,L,1),--this.size,!0}function L_(p){var I=this.__data__,L=vi(I,p);return L<0?void 0:I[L][1]}function U_(p){return vi(this.__data__,p)>-1}function $_(p,I){var L=this.__data__,k=vi(L,p);return k<0?(++this.size,L.push([p,I])):L[k][1]=I,this}Rt.prototype.clear=N_,Rt.prototype.delete=F_,Rt.prototype.get=L_,Rt.prototype.has=U_,Rt.prototype.set=$_;function er(p){var I=-1,L=p==null?0:p.length;for(this.clear();++I<L;){var k=p[I];this.set(k[0],k[1])}}function M_(){this.size=0,this.__data__={hash:new Pe,map:new(Ce||Rt),string:new Pe}}function j_(p){var I=wi(this,p).delete(p);return this.size-=I?1:0,I}function B_(p){return wi(this,p).get(p)}function z_(p){return wi(this,p).has(p)}function H_(p,I){var L=wi(this,p),k=L.size;return L.set(p,I),this.size+=L.size==k?0:1,this}er.prototype.clear=M_,er.prototype.delete=j_,er.prototype.get=B_,er.prototype.has=z_,er.prototype.set=H_;function bi(p){var I=-1,L=p==null?0:p.length;for(this.__data__=new er;++I<L;)this.add(p[I])}function q_(p){return this.__data__.set(p,i),this}function K_(p){return this.__data__.has(p)}bi.prototype.add=bi.prototype.push=q_,bi.prototype.has=K_;function Bt(p){var I=this.__data__=new Rt(p);this.size=I.size}function V_(){this.__data__=new Rt,this.size=0}function G_(p){var I=this.__data__,L=I.delete(p);return this.size=I.size,L}function W_(p){return this.__data__.get(p)}function k_(p){return this.__data__.has(p)}function Y_(p,I){var L=this.__data__;if(L instanceof Rt){var k=L.__data__;if(!Ce||k.length<r-1)return k.push([p,I]),this.size=++L.size,this;L=this.__data__=new er(k)}return L.set(p,I),this.size=L.size,this}Bt.prototype.clear=V_,Bt.prototype.delete=G_,Bt.prototype.get=W_,Bt.prototype.has=k_,Bt.prototype.set=Y_;function J_(p,I){var L=mi(p),k=!L&&f1(p),Ie=!L&&!k&&Bn(p),ne=!L&&!k&&!Ie&&oc(p),Ne=L||k||Ie||ne,Xe=Ne?Le(p.length,String):[],tt=Xe.length;for(var Ae in p)(I||ie.call(p,Ae))&&!(Ne&&(Ae=="length"||Ie&&(Ae=="offset"||Ae=="parent")||ne&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||o1(Ae,tt)))&&Xe.push(Ae);return Xe}function vi(p,I){for(var L=p.length;L--;)if(rc(p[L][0],I))return L;return-1}function X_(p,I,L){var k=I(p);return mi(p)?k:de(k,L(p))}function Hr(p){return p==null?p===void 0?M:B:dt&&dt in Object(p)?n1(p):h1(p)}function Za(p){return qr(p)&&Hr(p)==c}function Qa(p,I,L,k,Ie){return p===I?!0:p==null||I==null||!qr(p)&&!qr(I)?p!==p&&I!==I:Z_(p,I,L,k,Qa,Ie)}function Z_(p,I,L,k,Ie,ne){var Ne=mi(p),Xe=mi(I),tt=Ne?f:zt(p),Ae=Xe?f:zt(I);tt=tt==c?x:tt,Ae=Ae==c?x:Ae;var pt=tt==x,mt=Ae==x,st=tt==Ae;if(st&&Bn(p)){if(!Bn(I))return!1;Ne=!0,pt=!1}if(st&&!pt)return ne||(ne=new Bt),Ne||oc(p)?ec(p,I,L,k,Ie,ne):r1(p,I,tt,L,k,Ie,ne);if(!(L&n)){var _t=pt&&ie.call(p,"__wrapped__"),bt=mt&&ie.call(I,"__wrapped__");if(_t||bt){var Ht=_t?p.value():p,Nt=bt?I.value():I;return ne||(ne=new Bt),Ie(Ht,Nt,L,k,ne)}}return st?(ne||(ne=new Bt),i1(p,I,L,k,Ie,ne)):!1}function Q_(p){if(!sc(p)||c1(p))return!1;var I=ic(p)?Ee:q;return I.test(tr(p))}function e1(p){return qr(p)&&nc(p.length)&&!!Y[Hr(p)]}function t1(p){if(!u1(p))return _i(p);var I=[];for(var L in Object(p))ie.call(p,L)&&L!="constructor"&&I.push(L);return I}function ec(p,I,L,k,Ie,ne){var Ne=L&n,Xe=p.length,tt=I.length;if(Xe!=tt&&!(Ne&&tt>Xe))return!1;var Ae=ne.get(p);if(Ae&&ne.get(I))return Ae==I;var pt=-1,mt=!0,st=L&s?new bi:void 0;for(ne.set(p,I),ne.set(I,p);++pt<Xe;){var _t=p[pt],bt=I[pt];if(k)var Ht=Ne?k(bt,_t,pt,I,p,ne):k(_t,bt,pt,p,I,ne);if(Ht!==void 0){if(Ht)continue;mt=!1;break}if(st){if(!we(I,function(Nt,rr){if(!ye(st,rr)&&(_t===Nt||Ie(_t,Nt,L,k,ne)))return st.push(rr)})){mt=!1;break}}else if(!(_t===bt||Ie(_t,bt,L,k,ne))){mt=!1;break}}return ne.delete(p),ne.delete(I),mt}function r1(p,I,L,k,Ie,ne,Ne){switch(L){case J:if(p.byteLength!=I.byteLength||p.byteOffset!=I.byteOffset)return!1;p=p.buffer,I=I.buffer;case G:return!(p.byteLength!=I.byteLength||!ne(new wt(p),new wt(I)));case l:case D:case N:return rc(+p,+I);case w:return p.name==I.name&&p.message==I.message;case S:case a:return p==I+"";case F:var Xe=le;case v:var tt=k&n;if(Xe||(Xe=ce),p.size!=I.size&&!tt)return!1;var Ae=Ne.get(p);if(Ae)return Ae==I;k|=s,Ne.set(p,I);var pt=ec(Xe(p),Xe(I),k,Ie,ne,Ne);return Ne.delete(p),pt;case d:if(Be)return Be.call(p)==Be.call(I)}return!1}function i1(p,I,L,k,Ie,ne){var Ne=L&n,Xe=tc(p),tt=Xe.length,Ae=tc(I),pt=Ae.length;if(tt!=pt&&!Ne)return!1;for(var mt=tt;mt--;){var st=Xe[mt];if(!(Ne?st in I:ie.call(I,st)))return!1}var _t=ne.get(p);if(_t&&ne.get(I))return _t==I;var bt=!0;ne.set(p,I),ne.set(I,p);for(var Ht=Ne;++mt<tt;){st=Xe[mt];var Nt=p[st],rr=I[st];if(k)var ac=Ne?k(rr,Nt,st,I,p,ne):k(Nt,rr,st,p,I,ne);if(!(ac===void 0?Nt===rr||Ie(Nt,rr,L,k,ne):ac)){bt=!1;break}Ht||(Ht=st=="constructor")}if(bt&&!Ht){var Ei=p.constructor,Di=I.constructor;Ei!=Di&&"constructor"in p&&"constructor"in I&&!(typeof Ei=="function"&&Ei instanceof Ei&&typeof Di=="function"&&Di instanceof Di)&&(bt=!1)}return ne.delete(p),ne.delete(I),bt}function tc(p){return X_(p,p1,s1)}function wi(p,I){var L=p.__data__;return a1(I)?L[typeof I=="string"?"string":"hash"]:L.map}function hr(p,I){var L=pe(p,I);return Q_(L)?L:void 0}function n1(p){var I=ie.call(p,dt),L=p[dt];try{p[dt]=void 0;var k=!0}catch{}var Ie=ve.call(p);return k&&(I?p[dt]=L:delete p[dt]),Ie}var s1=Qt?function(p){return p==null?[]:(p=Object(p),_e(Qt(p),function(I){return It.call(p,I)}))}:g1,zt=Hr;(Ue&&zt(new Ue(new ArrayBuffer(1)))!=J||Ce&&zt(new Ce)!=F||$e&&zt($e.resolve())!=P||Me&&zt(new Me)!=v||je&&zt(new je)!=H)&&(zt=function(p){var I=Hr(p),L=I==x?p.constructor:void 0,k=L?tr(L):"";if(k)switch(k){case Ke:return J;case Ve:return F;case Ge:return P;case We:return v;case ke:return H}return I});function o1(p,I){return I=I??o,!!I&&(typeof p=="number"||ee.test(p))&&p>-1&&p%1==0&&p<I}function a1(p){var I=typeof p;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?p!=="__proto__":p===null}function c1(p){return!!be&&be in p}function u1(p){var I=p&&p.constructor,L=typeof I=="function"&&I.prototype||te;return p===L}function h1(p){return ve.call(p)}function tr(p){if(p!=null){try{return ge.call(p)}catch{}try{return p+""}catch{}}return""}function rc(p,I){return p===I||p!==p&&I!==I}var f1=Za(function(){return arguments}())?Za:function(p){return qr(p)&&ie.call(p,"callee")&&!It.call(p,"callee")},mi=Array.isArray;function l1(p){return p!=null&&nc(p.length)&&!ic(p)}var Bn=zr||y1;function d1(p,I){return Qa(p,I)}function ic(p){if(!sc(p))return!1;var I=Hr(p);return I==m||I==E||I==h||I==y}function nc(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=o}function sc(p){var I=typeof p;return p!=null&&(I=="object"||I=="function")}function qr(p){return p!=null&&typeof p=="object"}var oc=fe?Te(fe):e1;function p1(p){return l1(p)?J_(p):t1(p)}function g1(){return[]}function y1(){return!1}t.exports=d1})(In,In.exports);var Cg=In.exports,Rg=Object.defineProperty,aa=Object.getOwnPropertySymbols,Ng=Object.prototype.hasOwnProperty,Fg=Object.prototype.propertyIsEnumerable,ca=(t,e,r)=>e in t?Rg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,at=(t,e)=>{for(var r in e||(e={}))Ng.call(e,r)&&ca(t,r,e[r]);if(aa)for(var r of aa(e))Fg.call(e,r)&&ca(t,r,e[r]);return t};function Lg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var c=t.length,f=t.charAt(0),h=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function D(E){if(E instanceof Uint8Array||(ArrayBuffer.isView(E)?E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength):Array.isArray(E)&&(E=Uint8Array.from(E))),!(E instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(E.length===0)return"";for(var F=0,N=0,B=0,x=E.length;B!==x&&E[B]===0;)B++,F++;for(var P=(x-B)*l+1>>>0,y=new Uint8Array(P);B!==x;){for(var S=E[B],v=0,a=P-1;(S!==0||v<N)&&a!==-1;a--,v++)S+=256*y[a]>>>0,y[a]=S%c>>>0,S=S/c>>>0;if(S!==0)throw new Error("Non-zero carry");N=v,B++}for(var d=P-N;d!==P&&y[d]===0;)d++;for(var M=f.repeat(F);d<P;++d)M+=t.charAt(y[d]);return M}function w(E){if(typeof E!="string")throw new TypeError("Expected String");if(E.length===0)return new Uint8Array;var F=0;if(E[F]!==" "){for(var N=0,B=0;E[F]===f;)N++,F++;for(var x=(E.length-F)*h+1>>>0,P=new Uint8Array(x);E[F];){var y=r[E.charCodeAt(F)];if(y===255)return;for(var S=0,v=x-1;(y!==0||S<B)&&v!==-1;v--,S++)y+=c*P[v]>>>0,P[v]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");B=S,F++}if(E[F]!==" "){for(var a=x-B;a!==x&&P[a]===0;)a++;for(var d=new Uint8Array(N+(x-a)),M=N;a!==x;)d[M++]=P[a++];return d}}}function m(E){var F=w(E);if(F)return F;throw new Error(`Non-${e} character`)}return{encode:D,decodeUnsafe:w,decode:m}}var Ug=Lg,$g=Ug;const ua=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Mg=t=>new TextEncoder().encode(t),jg=t=>new TextDecoder().decode(t);class Bg{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class zg{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ha(this,e)}}class Hg{constructor(e){this.decoders=e}or(e){return ha(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ha=(t,e)=>new Hg(at(at({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class qg{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Bg(e,r,i),this.decoder=new zg(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const hi=({name:t,prefix:e,encode:r,decode:i})=>new qg(t,e,r,i),Mr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=$g(r,e);return hi({prefix:t,name:e,encode:i,decode:s=>ua(n(s))})},Kg=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let c=0,f=0,h=0;for(let l=0;l<s;++l){const D=n[t[l]];if(D===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|D,c+=r,c>=8&&(c-=8,o[h++]=255&f>>c)}if(c>=r||255&f<<8-c)throw new SyntaxError("Unexpected end of data");return o},Vg=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,c=0;for(let f=0;f<t.length;++f)for(c=c<<8|t[f],o+=8;o>r;)o-=r,s+=e[n&c>>o];if(o&&(s+=e[n&c<<r-o]),i)for(;s.length*r&7;)s+="=";return s},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>hi({prefix:e,name:t,encode(n){return Vg(n,i,r)},decode(n){return Kg(n,i,r,t)}}),Gg=hi({prefix:"\0",name:"identity",encode:t=>jg(t),decode:t=>Mg(t)});var Wg=Object.freeze({__proto__:null,identity:Gg});const kg=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yg=Object.freeze({__proto__:null,base2:kg});const Jg=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Xg=Object.freeze({__proto__:null,base8:Jg});const Zg=Mr({prefix:"9",name:"base10",alphabet:"0123456789"});var Qg=Object.freeze({__proto__:null,base10:Zg});const ey=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ty=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ry=Object.freeze({__proto__:null,base16:ey,base16upper:ty});const iy=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ny=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sy=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oy=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ay=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cy=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uy=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hy=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fy=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ly=Object.freeze({__proto__:null,base32:iy,base32upper:ny,base32pad:sy,base32padupper:oy,base32hex:ay,base32hexupper:cy,base32hexpad:uy,base32hexpadupper:hy,base32z:fy});const dy=Mr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),py=Mr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gy=Object.freeze({__proto__:null,base36:dy,base36upper:py});const yy=Mr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_y=Mr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var by=Object.freeze({__proto__:null,base58btc:yy,base58flickr:_y});const vy=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wy=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),my=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ey=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Dy=Object.freeze({__proto__:null,base64:vy,base64pad:wy,base64url:my,base64urlpad:Ey});const fa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Sy=fa.reduce((t,e,r)=>(t[r]=e,t),[]),xy=fa.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Oy(t){return t.reduce((e,r)=>(e+=Sy[r],e),"")}function Iy(t){const e=[];for(const r of t){const i=xy[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Py=hi({prefix:"\u{1F680}",name:"base256emoji",encode:Oy,decode:Iy});var Ay=Object.freeze({__proto__:null,base256emoji:Py}),Ty=da,la=128,Cy=127,Ry=~Cy,Ny=Math.pow(2,31);function da(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Ny;)e[r++]=t&255|la,t/=128;for(;t&Ry;)e[r++]=t&255|la,t>>>=7;return e[r]=t|0,da.bytes=r-i+1,e}var Fy=Pn,Ly=128,pa=127;function Pn(t,i){var r=0,i=i||0,n=0,s=i,o,c=t.length;do{if(s>=c)throw Pn.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&pa)<<n:(o&pa)*Math.pow(2,n),n+=7}while(o>=Ly);return Pn.bytes=s-i,r}var Uy=Math.pow(2,7),$y=Math.pow(2,14),My=Math.pow(2,21),jy=Math.pow(2,28),By=Math.pow(2,35),zy=Math.pow(2,42),Hy=Math.pow(2,49),qy=Math.pow(2,56),Ky=Math.pow(2,63),Vy=function(t){return t<Uy?1:t<$y?2:t<My?3:t<jy?4:t<By?5:t<zy?6:t<Hy?7:t<qy?8:t<Ky?9:10},Gy={encode:Ty,decode:Fy,encodingLength:Vy},ga=Gy;const ya=(t,e,r=0)=>(ga.encode(t,e,r),e),_a=t=>ga.encodingLength(t),An=(t,e)=>{const r=e.byteLength,i=_a(t),n=i+_a(r),s=new Uint8Array(n+r);return ya(t,s,0),ya(r,s,i),s.set(e,n),new Wy(t,r,e,s)};class Wy{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ba=({name:t,code:e,encode:r})=>new ky(t,e,r);class ky{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?An(this.code,r):r.then(i=>An(this.code,i))}else throw Error("Unknown type, must be binary type")}}const va=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Yy=ba({name:"sha2-256",code:18,encode:va("SHA-256")}),Jy=ba({name:"sha2-512",code:19,encode:va("SHA-512")});var Xy=Object.freeze({__proto__:null,sha256:Yy,sha512:Jy});const wa=0,Zy="identity",ma=ua;var Qy=Object.freeze({__proto__:null,identity:{code:wa,name:Zy,encode:ma,digest:t=>An(wa,ma(t))}});new TextEncoder,new TextDecoder;const Ea=at(at(at(at(at(at(at(at(at(at({},Wg),Yg),Xg),Qg),ry),ly),gy),by),Dy),Ay);at(at({},Xy),Qy);function e0(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Da(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Sa=Da("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Tn=Da("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=e0(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),t0=at({utf8:Sa,"utf-8":Sa,hex:Ea.base16,latin1:Tn,ascii:Tn,binary:Tn},Ea);function r0(t,e="utf8"){const r=t0[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const xa="wc",i0=2,Cn="core",$t=`${xa}@${2}:${Cn}:`,n0={name:Cn,logger:"error"},s0={database:":memory:"},o0="crypto",Oa="client_ed25519_seed",a0=Z.ONE_DAY,c0="keychain",u0="0.3",h0="messages",f0="0.3",l0=Z.SIX_HOURS,d0="publisher",Ia="irn",p0="error",g0="wss://relay.walletconnect.com",y0="relayer",nt={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},_0="_subscription",fi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Pa=Z.ONE_SECOND,b0="2.3.3",v0="0.3",xt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},w0="subscription",m0="0.3",E0=Z.FIVE_SECONDS*1e3,D0="pairing",S0="0.3",jr={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},Ot={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},x0="history",O0="0.3",I0="expirer",yt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},P0="0.3";class A0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=c0,this.version=u0,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Uo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?$o(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class T0{constructor(e,r,i){this.core=e,this.logger=r,this.name=o0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=ao(n);return oo(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Ud();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),o=ao(s),c=dn();return await Kl(c,n,a0,o)},this.generateSharedKey=(n,s,o)=>{this.isInitialized();const c=this.getPrivateKey(n),f=$d(c,s);return this.setSymKey(f,o)},this.setSymKey=async(n,s)=>{this.isInitialized();const o=s||Md(n);return await this.keychain.set(o,n),o},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,o)=>{this.isInitialized();const c=To(o),f=Ir(s);if(Co(c)){const w=c.senderPublicKey,m=c.receiverPublicKey;n=await this.generateSharedKey(w,m)}const h=this.getSymKey(n),{type:l,senderPublicKey:D}=c;return Bd({type:l,symKey:h,message:f,senderPublicKey:D})},this.decode=async(n,s,o)=>{this.isInitialized();const c=qd(s,o);if(Co(c)){const l=c.receiverPublicKey,D=c.senderPublicKey;n=await this.generateSharedKey(l,D)}const f=this.getSymKey(n),h=zd({symKey:f,encoded:s});return Vi(h)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new A0(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=gn(e);return Cr(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Oa)}catch{e=dn(),await this.keychain.set(Oa,e)}return r0(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class C0 extends Oh{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=h0,this.version=f0,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=pn(n);let o=this.messages.get(i);return typeof o>"u"&&(o={}),typeof o[s]<"u"||(o[s]=n,this.messages.set(i,o),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),o=pn(n);return typeof s[o]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Uo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?$o(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class R0 extends Ih{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new rt.exports.EventEmitter,this.name=d0,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,n,s)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});try{const o=s?.ttl||l0,c=yn(s),f=s?.prompt||!1,h=s?.tag||0,l={topic:i,message:n,opts:{ttl:o,relay:c,prompt:f,tag:h}},D=pn(n);this.queue.set(D,l);try{await await Mo(this.rpcPublish(i,n,o,c,f,h),this.publishTimeout),this.relayer.events.emit(nt.publish,l)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(nt.connection_stalled);return}this.onPublish(D,l),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}})}catch(o){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(o),o}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,s,o){var c,f,h,l;const D={method:_n(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:o}};return gt((c=D.params)==null?void 0:c.prompt)&&((f=D.params)==null||delete f.prompt),gt((h=D.params)==null?void 0:h.tag)&&((l=D.params)==null||delete l.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:D}),this.relayer.provider.request(D)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class N0{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var F0=Object.defineProperty,L0=Object.defineProperties,U0=Object.getOwnPropertyDescriptors,Aa=Object.getOwnPropertySymbols,$0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,Ta=(t,e,r)=>e in t?F0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,li=(t,e)=>{for(var r in e||(e={}))$0.call(e,r)&&Ta(t,r,e[r]);if(Aa)for(var r of Aa(e))M0.call(e,r)&&Ta(t,r,e[r]);return t},Rn=(t,e)=>L0(t,U0(e));class j0 extends Th{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new N0,this.events=new rt.exports.EventEmitter,this.name=w0,this.version=m0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=$t,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=yn(n),o={topic:i,relay:s};this.pending.set(i,o);const c=await this.rpcSubscribe(i,s);return this.onSubscribe(c,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,s)=>{const o=new Z.Watch;o.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),o.stop(this.pendingSubscriptionWatchLabel),n(!0)),o.elapsed(this.pendingSubscriptionWatchLabel)>=E0&&(clearInterval(c),o.stop(this.pendingSubscriptionWatchLabel),s(!1))},this.pendingSubInterval)}),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=yn(i);await this.rpcUnsubscribe(e,r,n);const s=ze("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:_n(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Mo(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(nt.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:_n(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.provider.request(n)}onSubscribe(e,r){this.setSubscription(e,Rn(li({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,Rn(li({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,li({},r)),this.topicMap.set(r.topic,e),this.events.emit(xt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(xt.deleted,Rn(li({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(xt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(xt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,n={topic:r,relay:i};this.pending.set(n.topic,n);const s=await this.rpcSubscribe(n.topic,n.relay);this.onResubscribe(s,n)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(nt.connect,async()=>{await this.onConnect()}),this.relayer.on(nt.disconnect,()=>{this.onDisconnect()}),this.events.on(xt.created,async e=>{const r=xt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(xt.deleted,async e=>{const r=xt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var B0=Object.defineProperty,Ca=Object.getOwnPropertySymbols,z0=Object.prototype.hasOwnProperty,H0=Object.prototype.propertyIsEnumerable,Ra=(t,e,r)=>e in t?B0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q0=(t,e)=>{for(var r in e||(e={}))z0.call(e,r)&&Ra(t,r,e[r]);if(Ca)for(var r of Ca(e))H0.call(e,r)&&Ra(t,r,e[r]);return t};class K0 extends Ph{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new rt.exports.EventEmitter,this.name=y0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):fr(Se.getDefaultLoggerOptions({level:e.logger||p0})),this.messages=new C0(this.logger,e.core),this.subscriber=new j0(this,this.logger),this.publisher=new R0(this,this.logger),this.relayUrl=e?.relayUrl||g0,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(n=>{this.subscriber.once(xt.created,s=>{s.topic===e&&n()})}),new Promise(async n=>{i=await this.subscriber.subscribe(e,r),n()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(nt.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(xt.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(nt.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(nt.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,Pa)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new $r(new Tg(ip({sdkVersion:b0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),xn(e)){if(!e.method.endsWith(_0))return;const r=e.params,{topic:i,message:n}=r.data,s={topic:i,message:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(q0({type:"event",event:r.id},s)),this.events.emit(r.id,s),await this.acknowledgePayload(e),await this.onMessageEvent(s)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(nt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Sn(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(fi.payload,e=>this.onProviderPayload(e)),this.provider.on(fi.connect,()=>{this.events.emit(nt.connect)}),this.provider.on(fi.disconnect,()=>{this.events.emit(nt.disconnect),this.attemptToReconnect()}),this.provider.on(fi.error,e=>this.events.emit(nt.error,e)),this.events.on(nt.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(Pa))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var V0=Object.defineProperty,Na=Object.getOwnPropertySymbols,G0=Object.prototype.hasOwnProperty,W0=Object.prototype.propertyIsEnumerable,Fa=(t,e,r)=>e in t?V0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,La=(t,e)=>{for(var r in e||(e={}))G0.call(e,r)&&Fa(t,r,e[r]);if(Na)for(var r of Na(e))W0.call(e,r)&&Fa(t,r,e[r]);return t};class di extends Ah{constructor(e,r,i,n=$t,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=v0,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{Sp(o)?this.map.set(o.id,o):xp(o)?this.map.set(o.topic,o):this.getKey&&o!==null&&!gt(o)&&this.map.set(this.getKey(o),o)}),this.cached=[],this.initialized=!0)},this.set=async(o,c)=>{this.isInitialized(),this.map.has(o)?await this.update(o,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:c}),this.map.set(o,c),await this.persist())},this.get=o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o)),this.getAll=o=>(this.isInitialized(),o?this.values.filter(c=>Object.keys(o).every(f=>Cg(c[f],o[f]))):this.values),this.update=async(o,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:c});const f=La(La({},this.getData(o)),c);this.map.set(o,f),await this.persist()},this.delete=async(o,c)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:c}),this.map.delete(o),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class k0{constructor(e,r){this.core=e,this.logger=r,this.name=D0,this.version=S0,this.events=new rt.exports,this.initialized=!1,this.storagePrefix=$t,this.ignoredPayloadTypes=[Xt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=dn(),n=await this.core.crypto.setSymKey(i),s=St(Z.FIVE_MINUTES),o={protocol:Ia},c={topic:n,expiry:s,relay:o,active:!1},f=pp({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:o});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:f}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:o}=lp(i.uri),c=St(Z.FIVE_MINUTES),f={topic:n,relay:o,expiry:c,active:!1};return await this.pairings.set(n,f),await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:o}),this.core.expirer.set(n,c),i.activatePairing&&await this.activate({topic:n}),f},this.activate=async({topic:i})=>{this.isInitialized();const n=St(Z.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:c,reject:f}=Zt();this.events.once(Fe("pairing_ping",s),({error:h})=>{h?f(h):c()}),await o()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ze("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const o=ci(n,s),c=await this.core.crypto.encode(i,o),f=jr[n].req;return this.core.history.set(i,o),await this.core.relayer.publish(i,c,f),o.id},this.sendResult=async(i,n,s)=>{const o=Sn(i,s),c=await this.core.crypto.encode(n,o),f=await this.core.history.get(n,i),h=jr[f.request.method].res;await this.core.relayer.publish(n,c,h),await this.core.history.resolve(o)},this.sendError=async(i,n,s)=>{const o=ui(i,s),c=await this.core.crypto.encode(n,o),f=await this.core.history.get(n,i),h=jr[f.request.method]?jr[f.request.method].res:jr.unregistered_method.res;await this.core.relayer.publish(n,c,h),await this.core.history.resolve(o)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ze("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Ut(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i,o=s.method;if(this.pairings.keys.includes(n))switch(o){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;if(this.pairings.keys.includes(n))switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit("pairing_ping",{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{Tt(n)?this.events.emit(Fe("pairing_ping",s),{}):vt(n)&&this.events.emit(Fe("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.sendResult(s,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const c=ze("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(ze("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!ft(i)){const{message:n}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!Dp(i.uri)){const{message:n}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!ft(i)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!ft(i)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Qe(i,!1)){const{message:n}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new di(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);xn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):On(n)&&(await this.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.core.expirer.on(yt.expired,async e=>{const{topic:r}=Bo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class Y0 extends xh{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new rt.exports.EventEmitter,this.name=x0,this.version=O0,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s};this.records.set(o.id,o),this.events.emit(Ot.created,o)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=vt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Ot.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(Ot.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:ci(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ot.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ot.created,e=>{const r=Ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ot.updated,e=>{const r=Ot.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Ot.deleted,e=>{const r=Ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class J0 extends Ch{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new rt.exports.EventEmitter,this.name=I0,this.version=P0,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(yt.created,{target:s,expiration:o})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(yt.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return np(e);if(typeof e=="number")return sp(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(yt.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(yt.created,e=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.expired,e=>{const r=yt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.deleted,e=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var X0=Object.defineProperty,Ua=Object.getOwnPropertySymbols,Z0=Object.prototype.hasOwnProperty,Q0=Object.prototype.propertyIsEnumerable,$a=(t,e,r)=>e in t?X0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ma=(t,e)=>{for(var r in e||(e={}))Z0.call(e,r)&&$a(t,r,e[r]);if(Ua)for(var r of Ua(e))Q0.call(e,r)&&$a(t,r,e[r]);return t};class Nn extends Sh{constructor(e){super(e),this.protocol=xa,this.version=i0,this.name=Cn,this.events=new rt.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e?.projectId;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:fr(Se.getDefaultLoggerOptions({level:e?.logger||n0.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new vr.HeartBeat,this.crypto=new T0(this,this.logger,e?.keychain),this.history=new Y0(this,this.logger),this.expirer=new J0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ru(Ma(Ma({},s0),e?.storageOptions)),this.relayer=new K0({core:this,logger:this.logger,relayUrl:e?.relayUrl,projectId:this.projectId}),this.pairing=new k0(this,this.logger)}static async init(e){const r=new Nn(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const e_=Nn,ja="wc",Ba=2,za="client",Fn=`${ja}@${Ba}:${za}:`,Ln={name:za,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},t_="proposal",r_="session",pi=Z.SEVEN_DAYS,i_="engine",Br={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},Un={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},n_="request";var s_=Object.defineProperty,o_=Object.defineProperties,a_=Object.getOwnPropertyDescriptors,Ha=Object.getOwnPropertySymbols,c_=Object.prototype.hasOwnProperty,u_=Object.prototype.propertyIsEnumerable,qa=(t,e,r)=>e in t?s_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ct=(t,e)=>{for(var r in e||(e={}))c_.call(e,r)&&qa(t,r,e[r]);if(Ha)for(var r of Ha(e))u_.call(e,r)&&qa(t,r,e[r]);return t},$n=(t,e)=>o_(t,a_(e));class h_ extends Nh{constructor(e){super(e),this.name=i_,this.events=new rt.exports,this.initialized=!1,this.ignoredPayloadTypes=[Xt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Br)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:n,relays:s}=r;let o=i,c,f=!1;if(o&&(f=this.client.core.pairing.pairings.get(o).active),!o||!f){const{topic:N,uri:B}=await this.client.core.pairing.create();o=N,c=B}const h=await this.client.core.crypto.generateKeyPair(),l={requiredNamespaces:n,relays:s??[{protocol:Ia}],proposer:{publicKey:h,metadata:this.client.metadata}},{reject:D,resolve:w,done:m}=Zt();if(this.events.once(Fe("session_connect"),async({error:N,session:B})=>{if(N)D(N);else if(B){B.self.publicKey=h;const x=$n(Ct({},B),{requiredNamespaces:B.requiredNamespaces});await this.client.session.set(B.topic,x),await this.setExpiry(B.topic,B.expiry),o&&await this.client.core.pairing.updateMetadata({topic:o,metadata:B.peer.metadata}),w(x)}}),!o){const{message:N}=V("NO_MATCHING_KEY",`connect() pairing topic: ${o}`);throw new Error(N)}const E=await this.sendRequest(o,"wc_sessionPropose",l),F=St(Z.FIVE_MINUTES);return await this.setProposal(E,Ct({id:E,expiry:F},l)),{uri:c,approval:m}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:s}=r,o=this.client.proposal.get(i);let{pairingTopic:c,proposer:f,requiredNamespaces:h}=o;oi(h)||(h=bp(s,"approve()"),this.client.proposal.set(i,$n(Ct({},o),{requiredNamespaces:h})));const l=await this.client.core.crypto.generateKeyPair(),D=f.publicKey,w=await this.client.core.crypto.generateSharedKey(l,D),m={relay:{protocol:n??"irn"},namespaces:s,requiredNamespaces:h,controller:{publicKey:l,metadata:this.client.metadata},expiry:St(pi)};await this.client.core.relayer.subscribe(w);const E=await this.sendRequest(w,"wc_sessionSettle",m),{done:F,resolve:N,reject:B}=Zt();this.events.once(Fe("session_approve",E),({error:P})=>{P?B(P):N(this.client.session.get(w))});const x=$n(Ct({},m),{topic:w,acknowledged:!1,self:m.controller,peer:{publicKey:f.publicKey,metadata:f.metadata},controller:l});return await this.client.session.set(w,x),await this.setExpiry(w,St(pi)),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:x.peer.metadata}),c&&i&&(await this.sendResult(i,c,{relay:{protocol:n??"irn"},responderPublicKey:l}),await this.client.proposal.delete(i,ze("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:c})),{topic:w,acknowledged:F}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:s}=this.client.proposal.get(i);s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,ze("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,s=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:o,resolve:c,reject:f}=Zt();return this.events.once(Fe("session_update",s),({error:h})=>{h?f(h):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:o}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:s,resolve:o,reject:c}=Zt();return this.events.once(Fe("session_extend",n),({error:f})=>{f?c(f):o()}),await this.setExpiry(i,St(pi)),{acknowledged:s}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:s,expiry:o}=r,c=await this.sendRequest(s,"wc_sessionRequest",{request:n,chainId:i},o),{done:f,resolve:h,reject:l}=Zt(o);return this.events.once(Fe("session_request",c),({error:D,result:w})=>{D?l(D):h(w)}),await f()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;Tt(n)?await this.sendResult(s,i,n.result):vt(n)&&await this.sendError(s,i,n.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:s,resolve:o,reject:c}=Zt();this.events.once(Fe("session_ping",n),({error:f})=>{f?c(f):o()}),await s()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:s})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",ze("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>mp(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,ze("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,ze("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=Br.wc_sessionRequest.req.ttl,{id:n,topic:s,params:o}=r;await this.client.pendingRequest.set(n,{id:n,topic:s,params:o}),i&&this.client.core.expirer.set(n,St(i))},this.sendRequest=async(r,i,n,s)=>{const o=ci(i,n),c=await this.client.core.crypto.encode(r,o),f=Br[i].req;return s&&(f.ttl=s),this.client.core.history.set(r,o),this.client.core.relayer.publish(r,c,f),o.id},this.sendResult=async(r,i,n)=>{const s=Sn(r,n),o=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),f=Br[c.request.method].res;this.client.core.relayer.publish(i,o,f),await this.client.core.history.resolve(s)},this.sendError=async(r,i,n)=>{const s=ui(r,n),o=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),f=Br[c.request.method].res;this.client.core.relayer.publish(i,o,f),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Ut(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Ut(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(Ct({},i.params));const o=St(Z.FIVE_MINUTES),c=Ct({id:s,pairingTopic:r,expiry:o},n);await this.setProposal(s,c),this.client.events.emit("session_proposal",{id:s,params:c})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Tt(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const o=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const c=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const f=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const h=await this.client.core.crypto.generateSharedKey(c,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:h});const l=await this.client.core.relayer.subscribe(h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else vt(i)&&(await this.client.proposal.delete(n,ze("USER_DISCONNECTED")),this.events.emit(Fe("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:c,expiry:f,namespaces:h,requiredNamespaces:l}=i.params,D={topic:r,relay:o,expiry:f,namespaces:h,acknowledged:!0,requiredNamespaces:l,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(Fe("session_connect"),{session:D})}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Tt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Fe("session_approve",n),{})):vt(i)&&(await this.client.session.delete(r,ze("USER_DISCONNECTED")),this.events.emit(Fe("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidUpdate(Ct({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(s,r,!0),this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError(s,r,o),this.client.logger.error(o)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Tt(i)?this.events.emit(Fe("session_update",n),{}):vt(i)&&this.events.emit(Fe("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,St(pi)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Tt(i)?this.events.emit(Fe("session_extend",n),{}):vt(i)&&this.events.emit(Fe("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Tt(i)?this.events.emit(Fe("session_ping",n),{}):vt(i)&&this.events.emit(Fe("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),this.client.core.relayer.once(nt.publish,async()=>{await this.deleteSession(r)}),await this.sendResult(n,r,!0),this.client.events.emit("session_delete",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(Ct({topic:r},s)),await this.setPendingSessionRequest({id:n,topic:r,params:s}),this.client.events.emit("session_request",{id:n,topic:r,params:s})}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Tt(i)?this.events.emit(Fe("session_request",n),{result:i.result}):vt(i)&&this.events.emit(Fe("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidEmit(Ct({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s})}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.isValidConnect=async r=>{if(!ft(r)){const{message:c}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(c)}const{pairingTopic:i,requiredNamespaces:n,relays:s}=r;if(gt(i)||await this.isValidPairingTopic(i),!gt(n)&&oi(n)===0)return;const o=Rp(n,"connect()");if(o)throw new Error(o.message);if(!Np(s,!0)){const{message:c}=V("MISSING_OR_INVALID",`connect() relays: ${s}`);throw new Error(c)}},this.isValidApprove=async r=>{if(!ft(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s}=r;await this.isValidProposalId(i);const o=this.client.proposal.get(i),c=ai(n,"approve()");if(c)throw new Error(c.message);const f=Wo(o.requiredNamespaces,n,"update()");if(f)throw new Error(f.message);if(!Qe(s,!0)){const{message:h}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}},this.isValidReject=async r=>{if(!ft(r)){const{message:s}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!Lp(n)){const{message:s}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!ft(r)){const{message:h}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(h)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!Vo(i)){const{message:h}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const c=Op(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const f=ai(s,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(Ut(o)){const{message:h}=V("EXPIRED","onSessionSettleRequest()");throw new Error(h)}},this.isValidUpdate=async r=>{if(!ft(r)){const{message:f}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=ai(n,"update()");if(o)throw new Error(o.message);const c=Wo(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!ft(r)){const{message:n}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!ft(r)){const{message:f}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:i,request:n,chainId:s,expiry:o}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Go(c,s)){const{message:f}=V("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(f)}if(!Up(n)){const{message:f}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(f)}if(!jp(c,s,n.method)){const{message:f}=V("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(f)}if(o&&!zp(o,Un)){const{message:f}=V("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Un.min} and ${Un.max}`);throw new Error(f)}},this.isValidRespond=async r=>{if(!ft(r)){const{message:s}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(s)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!$p(n)){const{message:s}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidPing=async r=>{if(!ft(r)){const{message:n}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!ft(r)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Go(o,s)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!Mp(n)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!Bp(o,s,n.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!ft(r)){const{message:n}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);xn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):On(n)&&(await this.client.core.history.resolve(n),this.onRelayEventResponse({topic:r,payload:n}))})}registerExpirerEvents(){this.client.core.expirer.on(yt.expired,async e=>{const{topic:r,id:i}=Bo(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Qe(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Qe(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Qe(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Fp(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class f_ extends di{constructor(e,r){super(e,r,t_,Fn),this.core=e,this.logger=r}}class l_ extends di{constructor(e,r){super(e,r,r_,Fn),this.core=e,this.logger=r}}class d_ extends di{constructor(e,r){super(e,r,n_,Fn),this.core=e,this.logger=r}}class Mn extends Rh{constructor(e){super(e),this.protocol=ja,this.version=Ba,this.name=Ln.name,this.events=new rt.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=e?.name||Ln.name,this.metadata=e?.metadata||Qd();const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:fr(Se.getDefaultLoggerOptions({level:e?.logger||Ln.logger}));this.core=e?.core||new e_(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new l_(this.core,this.logger),this.proposal=new f_(this.core,this.logger),this.pendingRequest=new d_(this.core,this.logger),this.engine=new h_(this)}static async init(e){const r=new Mn(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var jn={exports:{}};(function(t,e){var r=typeof self<"u"?self:qe,i=function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s}();(function(s){(function(o){var c={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function f(g){return g&&DataView.prototype.isPrototypeOf(g)}if(c.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(g){return g&&h.indexOf(Object.prototype.toString.call(g))>-1};function D(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(g))throw new TypeError("Invalid character in header field name");return g.toLowerCase()}function w(g){return typeof g!="string"&&(g=String(g)),g}function m(g){var _={next:function(){var U=g.shift();return{done:U===void 0,value:U}}};return c.iterable&&(_[Symbol.iterator]=function(){return _}),_}function E(g){this.map={},g instanceof E?g.forEach(function(_,U){this.append(U,_)},this):Array.isArray(g)?g.forEach(function(_){this.append(_[0],_[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(_){this.append(_,g[_])},this)}E.prototype.append=function(g,_){g=D(g),_=w(_);var U=this.map[g];this.map[g]=U?U+", "+_:_},E.prototype.delete=function(g){delete this.map[D(g)]},E.prototype.get=function(g){return g=D(g),this.has(g)?this.map[g]:null},E.prototype.has=function(g){return this.map.hasOwnProperty(D(g))},E.prototype.set=function(g,_){this.map[D(g)]=w(_)},E.prototype.forEach=function(g,_){for(var U in this.map)this.map.hasOwnProperty(U)&&g.call(_,this.map[U],U,this)},E.prototype.keys=function(){var g=[];return this.forEach(function(_,U){g.push(U)}),m(g)},E.prototype.values=function(){var g=[];return this.forEach(function(_){g.push(_)}),m(g)},E.prototype.entries=function(){var g=[];return this.forEach(function(_,U){g.push([U,_])}),m(g)},c.iterable&&(E.prototype[Symbol.iterator]=E.prototype.entries);function F(g){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}function N(g){return new Promise(function(_,U){g.onload=function(){_(g.result)},g.onerror=function(){U(g.error)}})}function B(g){var _=new FileReader,U=N(_);return _.readAsArrayBuffer(g),U}function x(g){var _=new FileReader,U=N(_);return _.readAsText(g),U}function P(g){for(var _=new Uint8Array(g),U=new Array(_.length),$=0;$<_.length;$++)U[$]=String.fromCharCode(_[$]);return U.join("")}function y(g){if(g.slice)return g.slice(0);var _=new Uint8Array(g.byteLength);return _.set(new Uint8Array(g)),_.buffer}function S(){return this.bodyUsed=!1,this._initBody=function(g){this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:c.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:c.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():c.arrayBuffer&&c.blob&&f(g)?(this._bodyArrayBuffer=y(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||l(g))?this._bodyArrayBuffer=y(g):this._bodyText=g=Object.prototype.toString.call(g):this._bodyText="",this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var g=F(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?F(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(B)}),this.text=function(){var g=F(this);if(g)return g;if(this._bodyBlob)return x(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(P(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(M)}),this.json=function(){return this.text().then(JSON.parse)},this}var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function a(g){var _=g.toUpperCase();return v.indexOf(_)>-1?_:g}function d(g,_){_=_||{};var U=_.body;if(g instanceof d){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,_.headers||(this.headers=new E(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!U&&g._bodyInit!=null&&(U=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=_.credentials||this.credentials||"same-origin",(_.headers||!this.headers)&&(this.headers=new E(_.headers)),this.method=a(_.method||this.method||"GET"),this.mode=_.mode||this.mode||null,this.signal=_.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&U)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(U)}d.prototype.clone=function(){return new d(this,{body:this._bodyInit})};function M(g){var _=new FormData;return g.trim().split("&").forEach(function(U){if(U){var $=U.split("="),R=$.shift().replace(/\+/g," "),C=$.join("=").replace(/\+/g," ");_.append(decodeURIComponent(R),decodeURIComponent(C))}}),_}function H(g){var _=new E,U=g.replace(/\r?\n[\t ]+/g," ");return U.split(/\r?\n/).forEach(function($){var R=$.split(":"),C=R.shift().trim();if(C){var j=R.join(":").trim();_.append(C,j)}}),_}S.call(d.prototype);function G(g,_){_||(_={}),this.type="default",this.status=_.status===void 0?200:_.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in _?_.statusText:"OK",this.headers=new E(_.headers),this.url=_.url||"",this._initBody(g)}S.call(G.prototype),G.prototype.clone=function(){return new G(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new E(this.headers),url:this.url})},G.error=function(){var g=new G(null,{status:0,statusText:""});return g.type="error",g};var J=[301,302,303,307,308];G.redirect=function(g,_){if(J.indexOf(_)===-1)throw new RangeError("Invalid status code");return new G(null,{status:_,headers:{location:g}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(_,U){this.message=_,this.name=U;var $=Error(_);this.stack=$.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function X(g,_){return new Promise(function(U,$){var R=new d(g,_);if(R.signal&&R.signal.aborted)return $(new o.DOMException("Aborted","AbortError"));var C=new XMLHttpRequest;function j(){C.abort()}C.onload=function(){var z={status:C.status,statusText:C.statusText,headers:H(C.getAllResponseHeaders()||"")};z.url="responseURL"in C?C.responseURL:z.headers.get("X-Request-URL");var Q="response"in C?C.response:C.responseText;U(new G(Q,z))},C.onerror=function(){$(new TypeError("Network request failed"))},C.ontimeout=function(){$(new TypeError("Network request failed"))},C.onabort=function(){$(new o.DOMException("Aborted","AbortError"))},C.open(R.method,R.url,!0),R.credentials==="include"?C.withCredentials=!0:R.credentials==="omit"&&(C.withCredentials=!1),"responseType"in C&&c.blob&&(C.responseType="blob"),R.headers.forEach(function(z,Q){C.setRequestHeader(Q,z)}),R.signal&&(R.signal.addEventListener("abort",j),C.onreadystatechange=function(){C.readyState===4&&R.signal.removeEventListener("abort",j)}),C.send(typeof R._bodyInit>"u"?null:R._bodyInit)})}return X.polyfill=!0,s.fetch||(s.fetch=X,s.Headers=E,s.Request=d,s.Response=G),o.Headers=E,o.Request=d,o.Response=G,o.fetch=X,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var n=i;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e})(jn,jn.exports);var Ka=cc(jn.exports);const Va={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"},Ga=10;class gi{constructor(e){if(this.url=e,this.events=new rt.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!ia(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e,r){this.isAvailable||await this.register();try{const i=Ir(e),s=await(await Ka(this.url,Object.assign(Object.assign({},Va),{body:i}))).json();this.onPayload({data:s})}catch(i){this.onError(e.id,i)}}async register(e=this.url){if(!ia(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{const r=Ir({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ka(e,Object.assign(Object.assign({},Va),{body:r})),this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Vi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=ui(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Xo(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ga&&this.events.setMaxListeners(Ga)}}function p_(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Mt(t,e){let r;return e.rpcMap&&(r=e.rpcMap[g_([t])]),r}function g_(t){return Number(t[0].split(":")[1])}class y_{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Mt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,r){const i=r||Mt(e,this.namespace);return typeof i>"u"?void 0:new $r(new gi(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class __{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Mt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Mt(e,this.namespace);return typeof i>"u"?void 0:new $r(new gi(i))}}class b_{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Mt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Mt(e,this.namespace);return typeof i>"u"?void 0:new $r(new gi(i))}}class v_{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Mt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Mt(e,this.namespace);return typeof i>"u"?void 0:new $r(new gi(i))}}const Wa="error",w_="wss://relay.walletconnect.com",m_="wc",E_="universal_provider",ka=`${m_}@${2}:${E_}:`;var D_=Object.defineProperty,S_=Object.defineProperties,x_=Object.getOwnPropertyDescriptors,Ya=Object.getOwnPropertySymbols,O_=Object.prototype.hasOwnProperty,I_=Object.prototype.propertyIsEnumerable,Ja=(t,e,r)=>e in t?D_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xa=(t,e)=>{for(var r in e||(e={}))O_.call(e,r)&&Ja(t,r,e[r]);if(Ya)for(var r of Ya(e))I_.call(e,r)&&Ja(t,r,e[r]);return t},P_=(t,e)=>S_(t,x_(e));class yi{constructor(e){this.events=new rt.exports,this.rpcProviders={},this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:fr(Se.getDefaultLoggerOptions({level:e?.logger||Wa}))}static async init(e){const r=new yi(e);return await r.initialize(),r}async request(e,r){const[i,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Xa({},e),chainId:`${i}:${n}`,topic:this.session.topic})}sendAsync(e,r,i){this.request(e,i).then(n=>r(null,n)).catch(n=>r(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ze("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:r}=e;return this.setNamespaces(r),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,r){try{const[i,n]=this.validateChain(e);this.getProvider(i).setDefaultChain(n,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Fr(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${ka}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Mn.init({logger:this.providerOpts.logger||Wa,relayUrl:this.providerOpts.relayUrl||w_,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new y_({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new __({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new b_({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new v_({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,r.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:n}=r,s=(i=this.client)==null?void 0:i.session.get(e);this.session=P_(Xa({},s),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${ka}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=e?.split(":")||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);return!r||!i?p_(this.namespaces):[r,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r){const[i,n]=this.validateChain(r);this.getProvider(i).setDefaultChain(n),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const A_=yi;qt.UniversalProvider=A_,qt.default=yi,Object.defineProperty(qt,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
